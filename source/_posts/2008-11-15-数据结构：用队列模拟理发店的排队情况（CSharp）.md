---
title: 数据结构：用队列模拟理发店的排队情况（C#）
date: 2008-11-15 12:17:00
tags: 杂7杂8
---
题目内容：使用的排队现象，通过仿真手法评估其营业状况。  
*基本要求：设某理发馆有N把理发椅，可同时为N位顾客进行理发。   
*当顾客进门时，若有空椅，则可以立即坐下理发，否则需要依次排队等候。   
*一旦有顾客理完发离去时，排在队头的顾客便可开始理发。   
*若理发馆每天连续营业T小时，求一天内顾客在理发馆内的平均逗留时间   
*顾客排队等候的队列平均长度 

N和T在运行的时候输入

用C#写的，有注释，很混乱，请高人指教~~

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Collections;

namespace 队列应用
{
    class Seat
    {
        public bool IsFree;
        public Customer cus = null;

        public Seat(bool b)
        {
            IsFree = b;
        }
    }

    class Customer
    {
        public int cometime;
        public int timetogo;
        public int cost = 30 - new Random().Next(10); //理发需要20~30分钟

        public Customer()
        {
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            System.Console.WriteLine("每天营业多少小时？");
            int workinghours = int.Parse(Console.ReadLine());
            System.Console.WriteLine("有多少个椅子？");
            int seats = int.Parse(Console.ReadLine());
            Process(seats, workinghours);
            Console.ReadLine();
        }

        static void Process(int num, int time)
        {
            //------------准备变量------------------------
            Queue q = new Queue(); //队列
            Seat[] S = new Seat[num]; //所有的椅子
            for (int i = 0; i < num; i++) //初始化椅子
            {
                S[i] = new Seat(true);
                S[i].cus = null;
            }

            int somebodycome = 1; //第一个顾客来的时间
            //int count = 0;//顾客计数器
            List<Customer> cuslist = new List<Customer>();
            int st = num; //椅子数
            int Qlen = 0; //队列长度
            int Qchangetime = 0; //队列长度改变次数
            //------------准备变量--------------------------
            for (int t = 1; t <= time * 60; t++) //时间从第一分钟开始流逝，每分钟检查状态
            {
                //--------检查现在有没有人需要离开--------------
                CheckLeave(S, t);
                //--------检查现在有没有人需要离开--------------
                //-------检查排队的人是否可以找到座位---------
                CheckSeat(q, S, ref Qlen, ref Qchangetime, t);
                //-------检查排队的人是否可以找到座位---------
                //-------------如果来人了，有座位就坐下，没座位就排队-------------------
                if (t == somebodycome)
                {
                    bool IsSitted = false; //当前刚来的顾客是否找到了座位
                    Customer c = new Customer();
                    c.cometime = t;
                    cuslist.Add(c);
                    foreach (Seat s in S)
                    {
                        if (s.IsFree == true)
                        {
                            s.IsFree = false;
                            s.cus = c;
                            s.cus.timetogo = t + s.cus.cost;
                            IsSitted = true;
                            break;
                        }
                    }

                    if (IsSitted == false)
                    {
                        q.Enqueue(c);
                        Qlen += q.Count;
                        Qchangetime++;
                    }
                    else
                    {
                        IsSitted = false;
                    }

                    somebodycome += 10 - new Random().Next(5); //下一个顾客来的时间,假设5~10分钟之内会有一个
                }

                //------如果来人了，有座位就坐下，没座位就排队---------
            }

            //---------加班----------
            bool Inseat = true;
            //bool InQ = true;
            bool KeepWorking = true;
            int curtime = time * 60 + 1;
            while (KeepWorking)
            {
                CheckLeave(S, curtime);
                CheckSeat(q, S, ref Qlen, ref Qchangetime, curtime);
                foreach (Seat s in S)
                {
                    if (s.IsFree == false)
                    {
                        Inseat = true;
                        break;
                    }
                    else
                    {
                        Inseat = false;
                    }
                }

                KeepWorking = Inseat;
                curtime++;
            }

            //---------加班----------
            //--------------
            int no = 1;
            foreach (Customer c in cuslist)
            {
                Console.Write("第{0}个顾客  ", no);
                Console.Write("来的时间：" + c.cometime);
                Console.WriteLine("  走的时间:" + c.timetogo);
                no++;
            } //------------------

            //--------打印结果-------------
            int totalstaytime = 0;
            foreach (Customer c in cuslist)
            {
                int staytime = c.timetogo - c.cometime;
                totalstaytime += staytime;
            }

            int averragestay = totalstaytime / cuslist.Count;
            System.Console.WriteLine("平均逗留时间:" + averragestay);
            System.Console.WriteLine("顾客数量:" + cuslist.Count);
            if (Qchangetime != 0)
            {
                int averagelen = Qlen / Qchangetime;
                Console.WriteLine("队列平均长度：" + averagelen);
            }
            else
            {
                Console.WriteLine("椅子充足，不用排队");
            }

            Console.WriteLine("加班时间：" + (curtime - time * 60) + "分钟");
            //--------打印结果------------
        }

        private static void CheckSeat(Queue q, Seat[] S, ref int Qlen, ref int Qchangetime, int t)
        {
            if (q.Count != 0) //如果有人排队
            {
                foreach (Seat s in S)
                {
                    if (s.IsFree == true)
                    {
                        s.IsFree = false;
                        s.cus = (Customer) q.Dequeue();
                        Qlen += q.Count;
                        Qchangetime++;
                        s.cus.timetogo = t + s.cus.cost; //
                    }
                }
            }
        }

        private static void CheckLeave(Seat[] S, int t)
        {
            foreach (Seat s in S)
            {
                if (s.cus != null)
                {
                    if (s.cus.timetogo == t)
                    {
                        s.IsFree = true;
                    }
                }
            }
        }
    }
}
```

