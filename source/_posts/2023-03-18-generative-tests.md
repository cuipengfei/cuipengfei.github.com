---
title: "å½“æµ‹è¯•ä»£ç ä½¿ç”¨éšæœºç”Ÿæˆçš„è¾“å…¥æ•°æ®æ—¶ï¼Œè¯¥å¦‚ä½•å»åšå‡ºæ–­è¨€"
date: 2023-03-18 22:34:00
tags:
- testing
---

# ä¸€ä»½æœ‰æ„æ€çš„ä»£ç 

æœ€è¿‘çœ‹åˆ°äº†ä¸€ä»½æœ‰è¶£çš„ä»£ç ï¼ŒæŠŠå…¶å¤§è‡´æ€è·¯ç”¨ä¼ªä»£ç æè¿°å¦‚ä¸‹ 

## éœ€è¦è¢«æµ‹çš„å®ç°ä»£ç 

```javascript
function calculateSomething(inputData) {
    // ä½¿ç”¨inputDataæ¥è®¡ç®—ç»“æœ
    // å‡è£…è¿™é‡Œæœ‰ä¸€äº›å¾ˆå¤æ‚çš„é€»è¾‘
    return result;
}
```

è¿™æ˜¯è¢«æµ‹çš„å‡½æ•°ï¼Œåœ¨æ­¤ä¸ç®¡å®ƒç®—çš„æ˜¯ä»€ä¹ˆï¼Œæ€»ä¹‹å®ƒæ¥å—inputï¼Œè¿”å›resultã€‚

## æµ‹è¯•ä»£ç çš„helpers

```javascript
function generateInputData(){
    // ç”¨æ¥ç”Ÿæˆæµ‹è¯•æ‰€éœ€çš„inputæ•°æ®
    // æ‰€ç”Ÿæˆçš„æ•°æ®å…·æœ‰ä¸€å®šçš„éšæœºæ€§
    return randomlyGeneratedInputData;
}

fuction calculateExpectedResult(inputData){
    // ç”¨æ¥è®¡ç®—assertionæ‰€éœ€è¦çš„expectedå€¼
    return expectedResult;
}
```

è¿™æ˜¯æµ‹è¯•ä»£ç çš„helperå‡½æ•°ï¼Œä¸€ä¸ªç”¨æ¥ç”Ÿæˆæµ‹è¯•æ‰€éœ€çš„inputï¼Œä¸€ä¸ªç”¨æ¥è®¡ç®—expectedçš„å€¼ã€‚

## æµ‹è¯•ä»£ç 

```javascript
var repeatTimes = 100; //æ€»ä¹‹æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„æ•°å­—ï¼Œä¸ä¸€å®šéå¾—æ˜¯100

for (i=0; i<repeatTimes; i++){
    var randomInputData = generateInputData(); //ç”Ÿæˆå…·æœ‰ä¸€å®šéšæœºæ€§çš„è¾“å…¥
    var expected = calculatedExpectedResult(randomInputData); //ç”¨æµ‹è¯•helperç®—å‡ºexpected
    var actual = calculateSomething(randomInputData); //ç”¨è¢«æµ‹æ–¹æ³•ç®—å‡ºactual

    expect(actual).toEqual(expected); //æ–­è¨€äºŒè€…ç›¸ç­‰
}
```

è¿™æ˜¯æµ‹è¯•ä»£ç ï¼Œåå¤è¿è¡Œå¤šæ¬¡ï¼Œæ¯æ¬¡éƒ½ç”Ÿæˆå…·æœ‰éšæœºæ€§çš„inputï¼Œç„¶åæŠŠinputä¼ é€’ç»™calculatedExpectedResultå’ŒcalculateSomethingï¼Œæœ€åæ–­è¨€äºŒè€…è¿”å›å€¼æ˜¯ä¸€è‡´çš„ã€‚

è¿™ä»½ä»£ç å’Œå¸¸è§çš„æµ‹è¯•ä¸åŒï¼Œå®ƒä½¿ç”¨çš„input dataä¸æ˜¯é¢„å…ˆè®¾å®šå¥½çš„ï¼Œè€Œæ˜¯è¿è¡Œæ—¶éšæœºç”Ÿæˆçš„ã€‚è¿™ä¹Ÿæ˜¯å®ƒæœ‰è¶£çš„åŸå› ã€‚

# å¦‚ä½•è§£è¯»æµ‹è¯•ç»“æœ

é€šå¸¸æ¥è¯´ï¼Œå½“æµ‹è¯•é€šè¿‡æ—¶ï¼Œå®ƒæ„å‘³ç€é’ˆå¯¹ç»™å®šçš„è¾“å…¥ï¼Œç¨‹åºç»™å‡ºäº†**ç¬¦åˆé¢„æœŸ**çš„è¾“å‡ºã€‚

ä½†æ˜¯å¯¹äºè¿™ä¸€ä»½ä»£ç æ¥è¯´ï¼Œå´å¹¶éå¦‚æ­¤ã€‚å› ä¸ºå®ƒçš„expectedå€¼æ˜¯ç”±ä¸€ä¸ªhelperå‡½æ•°è®¡ç®—å¾—æ¥ï¼Œè€Œéæ˜¯ä¸€ä¸ªå·²ç»è¢«éªŒè¯è¿‡æ˜¯æ­£ç¡®çš„å€¼ã€‚

é‚£ä¹ˆï¼Œå¦‚æœä¸Šè¿°çš„æµ‹è¯•ä»£ç èƒ½å¤Ÿæ‰§è¡Œé€šè¿‡æ—¶ï¼Œå®ƒåˆ°åº•æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ

* å®ƒæ„å‘³ç€```calculatedExpectedResult```è¿™ä¸ªhelperå‡½æ•°å’Œ```calculateSomething```è¿™ä¸ªè¢«æµ‹å‡½æ•°ä¹‹é—´ï¼Œå…·æœ‰è¾ƒé«˜çš„ç›¸ä¼¼æ€§ï¼ŒäºŒè€…é’ˆå¯¹ä¸€æ ·çš„è¾“å…¥ï¼Œå¯ä»¥ç»™å‡ºä¸€æ ·çš„è¾“å‡º

* å¦‚æœæˆ‘ä»¬æŠŠ```repeatTimes```çš„æ•°å€¼è°ƒåˆ°éå¸¸é«˜ï¼Œæµ‹è¯•è¿˜èƒ½é€šè¿‡çš„è¯ï¼Œé‚£å°±è¯´æ˜```calculatedExpectedResult```è¿™ä¸ªhelperå‡½æ•°å’Œ```calculateSomething```è¿™ä¸ªè¢«æµ‹å‡½æ•°ä¹‹é—´çš„ç›¸ä¼¼æ€§éå¸¸é«˜ï¼Œç®€ç›´å¯ä»¥è¾¾åˆ°åŒåµåŒèƒèƒç”šè‡³æ˜¯å…‹éš†ä½“è¿™ç§ä»¥å‡ä¹±çœŸçš„ç¨‹åº¦

**è¿™æ˜¯æˆ‘ä»¬éœ€è¦çš„å—ï¼Ÿ**

æˆ‘ä»¬**éœ€è¦å»æ¢å¯»ä¸–ç•Œä¸Šæ˜¯å¦å­˜åœ¨é‚£ä¹ˆä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„è¡Œä¸ºå¯ä»¥åšåˆ°å’Œ```calculateSomething```æå…¶è´´è¿‘å—ï¼Ÿ**

æˆ‘è®¤ä¸ºæˆ‘ä»¬æ˜¯ä¸éœ€è¦çš„ã€‚

æˆ‘ä»¬éœ€è¦çš„æ˜¯å»éªŒè¯```calculateSomething```çš„è¡Œä¸ºæ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚è€Œä¸æ˜¯å»éªŒè¯æˆ‘èƒ½å†™å‡ºå¦ä¸€ä¸ªå’Œå®ƒçš„è¡Œä¸ºå¾ˆåƒçš„å‡½æ•°æ¥ã€‚

è¿™å°±å¦‚åŒæ˜¯ï¼šå¦‚æœæˆ‘å»æµ‹è¯•æ´—è¡£æœºçš„è¯ï¼Œæˆ‘å¸Œæœ›éªŒè¯çš„æ˜¯æŸæ¬¾æ´—è¡£æœºå¯ä»¥æŠŠè¡£æœæ´—æ¶¤å¹²å‡€ï¼Œå¹¶ä¸”ä¸ä¼šæŸä¼¤è¡£ç‰©ã€‚è€Œä¸æ˜¯å¸Œæœ›éªŒè¯æœ‰å¦ä¸€å°æ´—è¡£æœºå’Œæˆ‘æ‰‹é‡Œè¿™ä¸€å°è¡¨ç°ä¸€æ ·ã€‚

è¦ä¸ç„¶çš„è¯ï¼Œæˆ‘è¯´ä¸å®šä¼šå¾—åˆ°ä¸¤å°æ´—ä¸å¹²å‡€è¡£æœï¼Œè¿˜ä¼šæŸä¼¤å¸ƒæ–™çš„æ´—è¡£æœºğŸ˜„

# å½“æµ‹è¯•ä»£ç ä½¿ç”¨éšæœºç”Ÿæˆçš„è¾“å…¥æ•°æ®æ—¶ï¼Œè¯¥å¦‚ä½•å»åšå‡ºæ–­è¨€

æƒ³è¦ç”¨éšæœºç”Ÿæˆçš„inputæ•°æ®å»åšæµ‹è¯•å…¶å®**å¹¶ä¸æ˜¯ä¸€ä¸ªä¸åˆç†çš„æƒ³æ³•**ã€‚

å½“æˆ‘ä»¬äººå·¥ç¼–åˆ¶çš„æµ‹è¯•æ•°æ®å¯¹äºæ•´ä½“æ ·æœ¬ç©ºé—´æ¥è¯´æ˜¾å¾—å¤ªå°æ—¶ï¼Œç”¨éšæœºæ•°æ®å»ä½œä¸ºinputæ•°æ®ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„è¡¥å……ã€‚

å…¶å…³é”®åœ¨äºï¼Œ**å½“æˆ‘ä»¬ç»™inputå¼•å…¥äº†éšæœºæ€§çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å»assertå…¶outputæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Ÿ**

å¦‚æœæˆ‘ä»¬è¿˜æ˜¯æƒ³è¦å’Œå¸¸è§„æµ‹è¯•ä¸€æ ·ï¼Œä¸¥æ ¼åœ°å»assertè¾“å‡ºçš„å€¼å’Œé¢„æœŸ**ç›¸ç­‰**ï¼Œé‚£ä¹ˆå°±ä¼šé™·å…¥ä¸Šè¿°ä»£ç çš„è¯¯åŒºé‡Œã€‚

ä½†æ˜¯å¦‚æœæ€è·¯æ¢ä¸€ä¸‹ï¼Œä¸ä¸€å®šéå¾—å¼ºæ±‚èƒ½å¤Ÿä¸¥æ ¼åœ°å»assertè¾“å‡ºçš„å€¼å’Œé¢„æœŸ**ç›¸ç­‰**ï¼Œè€Œæ˜¯å»assertè¾“å‡ºå€¼ç¬¦åˆä¸€å®šçš„è§„åˆ™ã€‚è¿™æ ·ï¼Œå°±æ— éœ€åœ¨æµ‹è¯•ä»£ç é‡Œé‡å¤å»å®ç°ä¸€éï¼Œè€Œåªéœ€è¦æè¿°è§„åˆ™ã€‚

# Property Based Testing

è€Œè¿™ï¼Œæ°å¥½å°±æ˜¯Property Based Testingã€‚

Property Based Testingæ˜¯ä¸€ç§åŸºäºå±æ€§è§„çº¦çš„æµ‹è¯•æ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨éšæœºè¾“å…¥æ•°æ®æ¥éªŒè¯ç¨‹åºçš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸçš„å±æ€§è§„çº¦ã€‚

åœ¨ Property Based Testing ä¸­ï¼Œæµ‹è¯•ç”¨ä¾‹ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ï¼Œè€Œæ˜¯åŸºäºå±æ€§è§„çº¦è‡ªåŠ¨ç”Ÿæˆã€‚

Property Based Testing çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š

* å®šä¹‰å±æ€§è§„çº¦ï¼šå®šä¹‰ç¨‹åºçš„è¡Œä¸ºåº”è¯¥æ»¡è¶³çš„å±æ€§è§„çº¦ï¼Œè¿™äº›è§„çº¦é€šå¸¸æ˜¯**é€šç”¨çš„ã€å¯é‡ç”¨çš„ã€æŠ½è±¡**çš„ï¼Œè€Œ**ä¸æ˜¯ç‰¹å®šçš„æµ‹è¯•ç”¨ä¾‹**ã€‚

* ç”Ÿæˆéšæœºæ•°æ®ï¼šé€šè¿‡éšæœºæ•°æ®ç”Ÿæˆå™¨ç”Ÿæˆéšæœºæ•°æ®ï¼Œå¹¶å°†éšæœºæ•°æ®è¾“å…¥åˆ°ç¨‹åºä¸­ã€‚

* æ£€æŸ¥å±æ€§è§„çº¦ï¼šå°†å®é™…è¾“å‡ºä¸å®šä¹‰çš„å±æ€§è§„çº¦è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¨‹åºçš„è¾“å‡ºç¬¦åˆå±æ€§è§„çº¦ï¼Œåˆ™æµ‹è¯•é€šè¿‡ï¼Œå¦åˆ™æµ‹è¯•å¤±è´¥ã€‚

* ä¿®å¤ä»£ç ï¼šå¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å¯¹ç¨‹åºè¿›è¡Œä¿®å¤ï¼Œç›´åˆ°ç¨‹åºèƒ½å¤Ÿç¬¦åˆæ‰€æœ‰å±æ€§è§„çº¦ã€‚

Property Based Testing çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æœ‰æ•ˆå‡å°‘æµ‹è¯•ç”¨ä¾‹çš„æ•°é‡ï¼Œæé«˜æµ‹è¯•è¦†ç›–é¢ï¼Œå‘ç°ç¨‹åºä¸­éšè—çš„é”™è¯¯ï¼Œå¹¶æé«˜ç¨‹åºçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä½†æ˜¯ï¼ŒProperty Based Testing ä¹Ÿéœ€è¦ä¸€å®šçš„æŠ€èƒ½å’Œç»éªŒï¼Œç‰¹åˆ«æ˜¯åœ¨å®šä¹‰å±æ€§è§„çº¦å’Œè®¾è®¡éšæœºæ•°æ®ç”Ÿæˆå™¨æ–¹é¢éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´å’Œç²¾åŠ›ã€‚

ä¸€äº›å¸¸ç”¨çš„ Property Based Testing æ¡†æ¶åŒ…æ‹¬ QuickCheckã€Hypothesisã€ScalaCheckã€fast-check ç­‰ã€‚

ä¸‹é¢æ˜¯ä¸€æ®µä½¿ç”¨Property Based Testingçš„æ ·ä¾‹ä»£ç ï¼š

```javascript
const fc = require('fast-check');

// Property-Based Testingï¼Œæµ‹è¯•åŠ æ³•å‡½æ•°
test('åŠ æ³•æ»¡è¶³äº¤æ¢å¾‹', () => {
    fc.assert(fc.property(fc.integer(), fc.integer(), (x, y) => {
        return add(x, y) === add(y, x);
    }));
});

test('åŠ 0ä¸å½±å“ç»“æœ', () => {
    fc.assert(fc.property(fc.integer(), (x) => {
        return add(x, 0) === x;
    }));
});

test('æ­£æ•°åŠ è´Ÿæ•°ï¼Œç»“æœå°äºåŸæ•°', () => {
    fc.assert(fc.property(fc.integer(-1000, -1), fc.integer(1, 1000), (x, y) => {
        return add(x, y) < x;
    }));
});

test('è´Ÿæ•°åŠ æ­£æ•°ï¼Œç»“æœå¤§äºåŸæ•°', () => {
    fc.assert(fc.property(fc.integer(-1000, -1), fc.integer(1, 1000), (x, y) => {
        return add(x, y) > x;
    }));
});

test('è´Ÿæ•°åŠ è´Ÿæ•°ï¼Œç»“æœå°äºåŸæ•°', () => {
    fc.assert(fc.property(fc.integer(-1000, -1), fc.integer(-1000, -1), (x, y) => {
        return add(x, y) < x;
    }));
});

test('æ­£æ•°åŠ æ­£æ•°ï¼Œç»“æœå¤§äºåŸæ•°', () => {
    fc.assert(fc.property(fc.integer(1, 1000), fc.integer(1, 1000), (x, y) => {
        return add(x, y) > x;
    }));
});

test('ä»»ä½•æ•°åŠ è‡ªå·±ï¼Œç»“æœæ˜¯ä¸¤å€', () => {
    fc.assert(fc.property(fc.integer(), (x) => {
        return add(x, x) === x * 2;
    }));
});
```

ä»£ç ä¸­æ‰€ä½¿ç”¨çš„fast-check(fc)ä¼šå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆå¤§é‡çš„å…·æœ‰éšæœºæ€§çš„è¾“å…¥æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰å»assert addçš„è¿”å›ç­‰äºæŸä¸ªå…·ä½“çš„æ•°å­—ï¼Œè€Œæ˜¯å»åˆ¤æ–­addçš„è¿”å›å€¼ç¬¦åˆæˆ‘ä»¬å®šä¹‰çš„è§„å¾‹ã€‚
