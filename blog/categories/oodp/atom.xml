<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: OODP | å´”é¹é£çš„Octopress Blog]]></title>
  <link href="http://cuipengfei.github.com/blog/categories/oodp/atom.xml" rel="self"/>
  <link href="http://cuipengfei.github.com/"/>
  <updated>2015-07-10T16:30:51+05:30</updated>
  <id>http://cuipengfei.github.com/</id>
  <author>
    <name><![CDATA[å´”é¹é£]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šå­ç±»å‹å¤šæ€å’Œé«˜é˜¶å‡½æ•°]]></title>
    <link href="http://cuipengfei.github.com/blog/2015/06/23/template-method-pattern/"/>
    <updated>2015-06-23T15:42:00+05:30</updated>
    <id>http://cuipengfei.github.com/blog/2015/06/23/template-method-pattern</id>
    <content type="html"><![CDATA[<blockquote><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ­¥éª¤ï¼Œå¹¶å…è®¸æ¬¡ç±»åˆ«ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å…¶å®è·µæ–¹å¼ã€‚è®©æ¬¡ç±»åˆ«åœ¨ä¸æ”¹å˜ç®—æ³•æ¶æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚</p></blockquote>

<p>ä»¥ä¸Šæ˜¯wikiå¯¹æ¨¡æ¿æ–¹æ³•çš„å®šä¹‰ã€‚</p>

<p>æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®—æ³•ï¼Œå…¶ä¸­æŸäº›æ­¥éª¤æ˜¯ç¡®å®šçš„ä¸å¤ªä¼šå˜çš„ä»£ç ã€‚è€Œå¦å¤–ä¸€äº›æ­¥éª¤åˆ™éœ€è¦å˜åŒ–å¹¶ä¸”è‡ªç”±ç»„åˆã€‚</p>

<p>ã€ŠHead First Design Patternsã€‹é‡Œæœ‰ä¸€ä¸ªğŸŒ°ï¼š</p>

<p>å‡è®¾æˆ‘ä»¬éœ€è¦åˆ¶ä½œå’–å•¡å› é¥®å“ï¼Œå…¶å®å°±æ˜¯å’–å•¡å’ŒèŒ¶ã€‚åˆ¶ä½œæ­¥éª¤æœ‰äº›ç±»ä¼¼ï¼Œåˆ†ä¸ºå››æ­¥ï¼š1çƒ§æ°´ï¼Œ2æ³¡ï¼Œ3è£…æ¯ï¼Œ4åŠ è°ƒæ–™ã€‚</p>

<p>å…¶ä¸­ç¬¬ä¸€æ­¥å’Œç¬¬ä¸‰æ­¥æ˜¯ç¨³å®šçš„ä»£ç ï¼Œå˜åŒ–å¯èƒ½æ€§ä¸å¤§ï¼Œè€Œç¬¬äºŒæ­¥å’Œç¬¬å››æ­¥åˆ™æ¯ç§é¥®å“æœ‰è‡ªå·±çš„é£å‘³ã€‚</p>

<p>è¿™æ ·å°±æœ‰äº†ä¸‹é¢çš„ä»£ç ï¼š</p>

<h1>Java</h1>

<script src="http://gist-it.appspot.com/https://github.com/cuipengfei/BlogCode/blob/master/OODPFP/src/main/java/templatemethodJ/CaffeineBeverage.java?slice=1:&footer=minimal">
</script>


<p>é¦–å…ˆæœ‰ä¸€ä¸ªå’–å•¡å› é¥®å“çš„æŠ½è±¡ç±»ï¼Œå®šä¹‰ä¸€ä¸ªç®—æ³•éª¨æ¶ï¼š1çƒ§æ°´ï¼Œ2æ³¡ï¼Œ3è£…æ¯ï¼Œ4åŠ è°ƒæ–™ã€‚
å…¶ä¸­çš„ç¬¬äºŒæ­¥å’Œç¬¬å››æ­¥æ˜¯æœ‰å¾…å®ç°çš„æŠ½è±¡æ–¹æ³•ï¼Œç•™ç»™å­ç±»å†³å®šæ€ä¹ˆæã€‚ç¬¬ä¸€æ­¥å’Œç¬¬ä¸‰æ­¥æ˜¯å†™æ­»çš„ã€‚</p>

<script src="http://gist-it.appspot.com/https://github.com/cuipengfei/BlogCode/blob/master/OODPFP/src/main/java/templatemethodJ/Coffee.java?slice=1:">
</script>


<p>æ¥ä¸‹æ¥æ˜¯å’–å•¡ï¼Œå®ƒå®ç°äº†è¿‡æ»¤å’–å•¡å’Œæ·»åŠ ç‰›å¥¶ã€ç³–çš„æ­¥éª¤ã€‚è¿™æ ·å½“å®ƒçš„å®ä¾‹çš„prepareRecipeæ–¹æ³•è¢«è°ƒç”¨æ—¶å°±ä¼šæ‰§è¡Œçˆ¶ç±»çš„çƒ§æ°´ã€è£…æ¯ï¼Œä»¥åŠè‡ªå·±çš„æ³¡å’ŒåŠ è°ƒæ–™ã€‚</p>

<script src="http://gist-it.appspot.com/https://github.com/cuipengfei/BlogCode/blob/master/OODPFP/src/main/java/templatemethodJ/Tea.java?slice=1:">
</script>


<p>è¿˜æœ‰ï¼Œå°±æ˜¯èŒ¶äº†ã€‚å®ƒå’Œå’–å•¡ä¸ä¸€æ ·ï¼Œæ˜¯ç”¨æµ¸æ³¡è€Œä¸æ˜¯è¿‡æ»¤ï¼ŒåŠ çš„æ˜¯æŸ æª¬è€Œä¸æ˜¯ç‰›å¥¶å’Œç³–ã€‚</p>

<script src="http://gist-it.appspot.com/https://github.com/cuipengfei/BlogCode/blob/master/OODPFP/src/main/java/templatemethodJ/BeverageTestDrive.java?slice=1:">
</script>


<p>æœ€åç”¨ä¸€ä¸ªmainå‡½æ•°æ¥æ‰§è¡Œåˆ¶ä½œå’–å•¡å’ŒèŒ¶çš„ä»£ç ã€‚</p>

<p>å¾ˆå¥½ï¼Œå¦‚æœå†æœ‰å…¶ä»–çš„å’–å•¡å› é¥®å“ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªå­ç±»ï¼Œå¹¶ä¸”å®ç°ä¸¤ä¸ªæ–¹æ³•å°±å¥½äº†ã€‚åªè¦æˆ‘ä»¬å¯¹äºå››ä¸ªæ­¥éª¤çš„å®šä¹‰åœ¨è¯¥é¢†åŸŸä¸­è¶³å¤Ÿç¨³å®šï¼Œè¿™ä»½ä»£ç å°±æ˜¯å¾ˆå¥½å¾ˆå¼ºå¤§ï¼Œæ˜“äºæ‰©å±•çš„ã€‚</p>

<p>æœ‰ä»£ç å¦‚æ­¤ï¼Œå¤«å¤ä½•æ±‚å‘¢ï¼Ÿ</p>

<h2>ä¸è¿‡å†æƒ³ä¸€ä¸‹</h2>

<p>è¿™ä¸ªæ¨¡å¼æƒ³è¦è¾¾åˆ°çš„ï¼Œä¸è¿‡æ˜¯å°†ä¸€ä¸ªç®—æ³•çš„æŸäº›éƒ¨åˆ†åšçš„çµæ´»ä¸€äº›ï¼Œå¯ä»¥è‡ªç”±æ›¿æ¢å’Œç»„åˆã€‚</p>

<p>é‚£è¿™ä¸ªï¼Œä¸å°±æ˜¯å‡½æ•°ç»„åˆå—ï¼Ÿå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…è®¸é«˜é˜¶å‡½æ•°çš„è¯­è¨€çš„è¯ï¼Œé‚£è¿˜æœ‰ä»€ä¹ˆå¿…è¦æŠŠè¿™äº›å‡½æ•°åŒ…è£…åœ¨ç±»é‡Œå‘¢ï¼Ÿ</p>

<h1>functions</h1>

<p>æ¥ä¸‹æ¥æ˜¯ç”¨Scalaå®ç°çš„ç‰ˆæœ¬ï¼š</p>

<script src="http://gist-it.appspot.com/https://github.com/cuipengfei/BlogCode/blob/master/OODPFP/src/main/scala/templatemethodS/Beverages.scala?slice=1:">
</script>


<p>é¦–å…ˆï¼Œå®šä¹‰ä¸‰ä¸ªtypeï¼Œåˆ†åˆ«æ˜¯æ³¡å’ŒåŠ è°ƒæ–™è¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œè¿˜æœ‰é¥®å“æœ¬èº«ï¼ˆè¿™ä¸‰ä¸ªtypeå…¶å®æ˜¯ä¸€æ ·çš„ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹å‚»ï¼‰ã€‚</p>

<p>ç„¶åæœ‰ä¸€ä¸ªç®—æ³•éª¨æ¶ï¼ŒæŠŠç¬¬ä¸€å’Œç¬¬ä¸‰æ­¥é”æ­»ï¼ŒæŠŠç¬¬äºŒå’Œç¬¬å››æ­¥ç©ºå‡ºæ¥ï¼Œåˆ†åˆ«ç”¨ä¸€ä¸ªå‚æ•°æ¥å®ç°æ³¨å…¥ä¸åŒçš„å®ç°ã€‚</p>

<p>æ¥ä¸‹æ¥æœ‰æ³¡å’ŒåŠ è°ƒæ–™çš„å››ç§ä¸åŒå®ç°ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¦åˆå„è‡ªçš„å‡½æ•°ç­¾åã€‚</p>

<p>æœ€åï¼Œç”¨ä¸€ä¸ªmainå‡½æ•°æ¥æ‰§è¡Œã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ³¡å’ŒåŠ è°ƒæ–™çš„å‡½æ•°æ˜¯ä½œä¸ºå‚æ•°ä¼ å…¥çš„ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åŠ ç‰›å¥¶å’Œç³–çš„èŒ¶ï¼Œæˆ–è€…æ˜¯æŸ æª¬å‘³çš„å’–å•¡çš„è¯ï¼Œä¹Ÿä¼šå˜å¾—éå¸¸å®¹æ˜“ã€‚</p>

<p>å°±è¿™æ ·ï¼Œ51è¡Œä»£ç å˜æˆäº†28è¡Œã€‚å››ä¸ªç±»å˜æˆäº†ä¸€ä¸ªobjectã€‚</p>

<p>è€Œå¦‚æœæ˜¯è¦ç”¨å­ç±»å‹å¤šæ€ï¼ˆsubtype polymorphismï¼‰æ¥åšåˆ°è¿™æ ·çš„è‡ªç”±ç»„åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦çš„æˆ–è®¸å°±æ˜¯ç­–ç•¥æ¨¡å¼ï¼ŒæŠŠæ³¡å’ŒåŠ è°ƒæ–™åˆ†åˆ«å†™æˆæ¥å£å¹¶æä¾›ä¸åŒçš„å®ç°ç±»æ¥ç»„åˆã€‚å¯ä»¥æƒ³è±¡ï¼Œè¿™ä¼šå¯¼è‡´å¾ˆå¤šçš„boilerplateã€‚</p>

<h1>ç»“è¯­</h1>

<p>Javaä»£ç ä¸­å®ç°å¤šæ€çš„æ–¹å¼æ˜¯é€šè¿‡å­ç±»ç»§æ‰¿çˆ¶ç±»å¹¶ä¸”å®ç°æŠ½è±¡æ–¹æ³•æ¥å®ç°çš„ã€‚è€ŒScalaä»£ç ä¸­åˆ™æ˜¯é€šè¿‡æŠŠä¸åŒçš„å‡½æ•°ä¼ å…¥éª¨æ¶ç»„åˆå‡ºä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å®ç°çš„ã€‚</p>

<p>å­ç±»å‹å¤šæ€ï¼ˆsubtype polymorphismï¼‰æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¾å¾—æœ‰ç‚¹é‡ã€‚èƒ½ç”¨é«˜é˜¶å‡½æ•°è¿™ç§è½»é‡çº§çš„æ–¹å¼æ¥å®ç°çš„æ—¶å€™ï¼Œå°±æ²¡æœ‰å¿…è¦é€‰æ‹©å­ç±»å‹å¤šæ€è¿™ç§è¿‡é‡çš„æ–¹å¼ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®¿é—®è€…æ¨¡å¼ in FPï¼šPattern Matching]]></title>
    <link href="http://cuipengfei.github.com/blog/2015/06/16/visitor-pattern-pattern-match/"/>
    <updated>2015-06-16T19:11:00+05:30</updated>
    <id>http://cuipengfei.github.com/blog/2015/06/16/visitor-pattern-pattern-match</id>
    <content type="html"><![CDATA[<blockquote><p>è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§å°†ç®—æ³•ä¸å¯¹è±¡ç»“æ„åˆ†ç¦»çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚</p>

<p>è¿™ä¸ªæ¨¡å¼çš„åŸºæœ¬æƒ³æ³•å¦‚ä¸‹ï¼šé¦–å…ˆæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªç”±è®¸å¤šå¯¹è±¡æ„æˆçš„å¯¹è±¡ç»“æ„ï¼Œè¿™äº›å¯¹è±¡çš„ç±»éƒ½æ‹¥æœ‰ä¸€ä¸ªacceptæ–¹æ³•ç”¨æ¥æ¥å—è®¿é—®è€…å¯¹è±¡ï¼›è®¿é—®è€…æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ªvisitæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹è®¿é—®åˆ°çš„å¯¹è±¡ç»“æ„ä¸­ä¸åŒç±»å‹çš„å…ƒç´ ä½œå‡ºä¸åŒçš„ååº”ï¼›åœ¨å¯¹è±¡ç»“æ„çš„ä¸€æ¬¡è®¿é—®è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éå†æ•´ä¸ªå¯¹è±¡ç»“æ„ï¼Œå¯¹æ¯ä¸€ä¸ªå…ƒç´ éƒ½å®æ–½acceptæ–¹æ³•ï¼Œåœ¨æ¯ä¸€ä¸ªå…ƒç´ çš„acceptæ–¹æ³•ä¸­å›è°ƒè®¿é—®è€…çš„visitæ–¹æ³•ï¼Œä»è€Œä½¿è®¿é—®è€…å¾—ä»¥å¤„ç†å¯¹è±¡ç»“æ„çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥é’ˆå¯¹å¯¹è±¡ç»“æ„è®¾è®¡ä¸åŒçš„å®åœ¨çš„è®¿é—®è€…ç±»æ¥å®Œæˆä¸åŒçš„æ“ä½œã€‚</p></blockquote>

<p>ä»¥ä¸Šæ˜¯wikiå¯¹è®¿é—®è€…æ¨¡å¼çš„å®šä¹‰ã€‚</p>

<p>è¿™ä¸ªå®šä¹‰ç€å®éš¾è¯»ã€‚æˆ‘ä»¬æ¥çœ‹wikiç»™å‡ºçš„ä¾‹å­ï¼š</p>

<p>å‡è®¾æˆ‘ä»¬è¦ä¸ºæ±½è½¦å»ºæ¨¡ï¼Œæ±½è½¦æœ‰ä¸åŒçš„ç»„æˆéƒ¨ä»¶ï¼Œè½®èƒï¼Œè½¦èº«ï¼Œå’Œå¼•æ“ã€‚</p>

<p>åœ¨å¼€è½¦ä¹‹å‰éœ€è¦å…ˆæ£€æŸ¥è½¦è¾†æ¯ä¸ªéƒ¨ä»¶çš„çŠ¶å†µï¼Œç„¶åä¾æ¬¡å¯åŠ¨æ‰€æœ‰éƒ¨ä»¶ä»¥å¯åŠ¨æ±½è½¦ã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¾ˆå®¹æ˜“è¯†åˆ«å‡ºè½¦çš„ç»„ä»¶å„è‡ªåº”è¯¥æ˜¯ä¸€ä¸ªå®ä½“ã€‚è€Œå¯¹è½¦è¾†ç»„ä»¶è¿›è¡Œæ£€æŸ¥å’Œå¯åŠ¨çš„ä»£ç åº”è¯¥åˆ†åˆ«å¤„äºä¸åŒçš„å®ä½“ä¸­ã€‚</p>

<p>è¿™æ ·å°±æœ‰äº†è®¿é—®è€…çš„ä»£ç ï¼ˆæ¥è‡ªwikiï¼‰ï¼š</p>

<h1>Java</h1>

<p>```java
interface ICarElement {</p>

<pre><code>void accept(ICarElementVisitor visitor);
</code></pre>

<p>}</p>

<p>class Wheel implements ICarElement {</p>

<pre><code>private String name;

public Wheel(String name) {
    this.name = name;
}

public String getName() {
    return this.name;
}

public void accept(ICarElementVisitor visitor) {
    visitor.visit(this);
}
</code></pre>

<p>}</p>

<p>class Engine implements ICarElement {</p>

<pre><code>public void accept(ICarElementVisitor visitor) {
    visitor.visit(this);
}
</code></pre>

<p>}</p>

<p>class Body implements ICarElement {</p>

<pre><code>public void accept(ICarElementVisitor visitor) {
    visitor.visit(this);
}
</code></pre>

<p>}</p>

<p>class Car implements ICarElement {</p>

<pre><code>ICarElement[] elements;

public Car() {
    this.elements = new ICarElement[]{new Wheel("front left"),
            new Wheel("front right"), new Wheel("back left"),
            new Wheel("back right"), new Body(), new Engine()};
}

public void accept(ICarElementVisitor visitor) {
    for (ICarElement elem : elements) {
        elem.accept(visitor);
    }
    visitor.visit(this);
}
</code></pre>

<p>}
```</p>

<p>é¦–å…ˆæ˜¯æ±½è½¦éƒ¨ä»¶çš„å®ä½“ã€‚å®ƒä»¬éƒ½å®ç°åŒä¸€ä¸ªICarElementçš„æ¥å£ã€‚
è¯¥æ¥å£å®šä¹‰ä¸€ä¸ªacceptæ–¹æ³•ï¼Œç”¨æ¥æ¥å—è®¿é—®è€…ç„¶åç”¨è®¿é—®è€…æ¥è®¿é—®æ‰€æœ‰æ±½è½¦éƒ¨ä»¶ã€‚</p>

<p>```java
interface ICarElementVisitor {</p>

<pre><code>void visit(Wheel wheel);

void visit(Engine engine);

void visit(Body body);

void visit(Car car);
</code></pre>

<p>}</p>

<p>class CarElementPrintVisitor implements ICarElementVisitor {</p>

<pre><code>public void visit(Wheel wheel) {
    System.out.println("Visiting " + wheel.getName() + " wheel");
}

public void visit(Engine engine) {
    System.out.println("Visiting engine");
}

public void visit(Body body) {
    System.out.println("Visiting body");
}

public void visit(Car car) {
    System.out.println("Visiting car");
}
</code></pre>

<p>}</p>

<p>class CarElementDoVisitor implements ICarElementVisitor {</p>

<pre><code>public void visit(Wheel wheel) {
    System.out.println("Kicking my " + wheel.getName() + " wheel");
}

public void visit(Engine engine) {
    System.out.println("Starting my engine");
}

public void visit(Body body) {
    System.out.println("Moving my body");
}

public void visit(Car car) {
    System.out.println("Starting my car");
}
</code></pre>

<p>}
```</p>

<p>ç„¶åå°±æ˜¯è®¿é—®è€…çš„å®ä½“ã€‚å®ƒä»¬éƒ½å®ç°ICarElementVisitoræ¥å£ã€‚
è¿™ä¸ªæ¥å£é‡Œå®šä¹‰çš„æ–¹æ³•æœ‰ç‚¹å¤šï¼Œåˆ†åˆ«å¯¹åº”æ¯ä¸ªæ±½è½¦éƒ¨ä»¶å®šä¹‰äº†ä¸€ä¸ªvisitæ–¹æ³•çš„é‡è½½ã€‚</p>

<p>åœ¨å®ç°çš„æ—¶å€™è‡ªç„¶æ˜¯åšæ£€æŸ¥çš„å®ä½“å®ç°æ¯ä¸ªéƒ¨ä»¶çš„æ£€æŸ¥ï¼Œå¯åŠ¨çš„å®ä½“å®ç°æ¯ä¸ªéƒ¨ä»¶çš„å¯åŠ¨ã€‚</p>

<p>è¿™é‡Œå°±æœ‰ä¸€ä¸ªé™·é˜±ï¼Œå¦‚æœä»£ç å‘å±•çš„è¶‹åŠ¿æ˜¯æ±½è½¦éƒ¨ä»¶çš„ç§ç±»ä¼šå¢åŠ çš„è¯ï¼Œé‚£è¿™ä¸ªæ¥å£å°±å¾ˆä¸ç¨³å®šã€‚æ¯å¢åŠ ä¸€ç§æ±½è½¦éƒ¨ä»¶å°±è¦ä¿®æ”¹æ¥å£å¹¶ä¸”ä¿®æ”¹æ¯ä¸ªå®ç°ç±»ã€‚</p>

<p>è€Œå¦‚æœä»£ç å‘å±•çš„è¶‹åŠ¿æ˜¯åœ¨è‡ªæ£€å’Œå¯åŠ¨ä¹‹å¤–åŠ ä¸€äº›ä¿å…»å•Šï¼Œæ´—è½¦å•Šä¹‹ç±»çš„è¯å°±æ²¡é—®é¢˜ï¼Œä¸éœ€è¦å¯¹å·²æœ‰ä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p>

<p>æ‰€ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼çš„æ—¶å€™è¦æ³¨æ„è¯†åˆ«è¢«è®¿é—®è€…æ˜¯å¦æ˜¯ç›¸å¯¹ç¨³å®šè€Œè®¿é—®è€…æ˜¯æœ‰æ‰©å±•è¶‹åŠ¿çš„ï¼Œè¿™æ ·ç”¨è¿™ä¸ªæ¨¡å¼æ‰åˆé€‚ã€‚</p>

<p>æ¥ä¸‹æ¥çš„ä»£ç æŠŠä»¥ä¸Šæ‰€æœ‰ä»£ç ä¸²èµ·æ¥æ‰§è¡Œï¼š</p>

<p>```java
public class VisitorDemo {</p>

<pre><code>public static void main(String[] args) {
    ICarElement car = new Car();
    car.accept(new CarElementPrintVisitor());
    car.accept(new CarElementDoVisitor());
}
</code></pre>

<p>}
```</p>

<p>ä»æœ€åçš„mainå‡½æ•°æ¥çœ‹ï¼Œåªè¦èƒ½ç¡®ä¿æ±½è½¦éƒ¨ä»¶çš„æ•°é‡ä¸ä¼šå¢åŠ ï¼Œè€Œåªæœ‰è®¿é—®è€…å¢åŠ ï¼Œé‚£ä¹ˆå®¢æˆ·ä»£ç åªéœ€è¦å¢åŠ ä¸€è¡Œå°±èƒ½å¤Ÿå¢åŠ å¯¹æ•´è½¦è¿›è¡Œæ¸…æ´—æˆ–è€…ä¿å…»çš„è¡Œä¸ºã€‚</p>

<p>è½¦çš„éƒ¨ä»¶å’Œå¯¹éƒ¨ä»¶çš„æ“ä½œç›¸äº’åˆ†ç¦»ï¼Œç‹¬ç«‹å‘å±•ã€‚å¾ˆçµæ´»ï¼Œå¾ˆå·§å¦™ï¼Œå¯¹å§ï¼Ÿ</p>

<h2>ä¸è¿‡å†æƒ³ä¸€ä¸‹</h2>

<p>å…¶å®ä¹Ÿä¸éœ€è¦ä½¿åŠ²æƒ³äº†ï¼Œå¦‚æœä½ çœ‹è¿‡è¿™ä¸€ç³»åˆ—åšæ–‡å‰é¢çš„å‡ ç¯‡çš„è¯ï¼Œæƒ³å¿…å·²ç»èƒ½å¤ŸçŒœåˆ°æˆ‘çš„ç”¨æ„äº†ã€‚</p>

<p>è¿™äº›è®¿é—®è€…å­˜åœ¨çš„æ„ä¹‰å°±åœ¨äºæ‰¿è½½å¯¹æ±½è½¦éƒ¨ä»¶çš„æŸäº›å…·ä½“æ“ä½œï¼Œæ“ä½œæ˜¯ä¸ªå¥½å¬çš„è¯å„¿ï¼Œè¯´ç™½äº†å°±æ˜¯å‡½æ•°å•Šã€‚</p>

<p>é‚£æ—¢ç„¶è¿™äº›ç±»åªæ˜¯æ‰¿è½½å‡½æ•°è€Œå·²ï¼Œä½•ä¸ç›´æ¥å°±ç”¨å‡½æ•°è€Œä¸è´¹åŠ²å»ç”¨ç±»åŒ…è£¹ä¸€å±‚å‘¢ï¼Ÿ</p>

<h1>functions</h1>

<p>é‚£æ¥ä¸‹æ¥å°±æ˜¯ç”¨Scalaçš„å®ç°ï¼š</p>

<p>```scala
trait CarElement {
  def accept(visitor: Visitor) = visitor(this)
}</p>

<p>case class Body() extends CarElement</p>

<p>case class Engine() extends CarElement</p>

<p>case class Wheel(name: String) extends CarElement</p>

<p>case class Car() extends CarElement {
  val elements: Seq[CarElement] = Seq(</p>

<pre><code>Wheel("front left"), Wheel("front right"),
Wheel("back left"), Wheel("back right"),
Body(), Engine())
</code></pre>

<p>  override def accept(visitor: Visitor) = {</p>

<pre><code>elements.foreach(_.accept(visitor))
visitor(this)
</code></pre>

<p>  }
}
```</p>

<p>ä»¥ä¸Šæ˜¯æ±½è½¦å„ç§éƒ¨ä»¶çš„å®šä¹‰ï¼Œå’ŒJavaä»£ç æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚</p>

<p>```scala
object Visitors {
  type Visitor = CarElement => Unit</p>

<p>  val printVisitor: Visitor = {</p>

<pre><code>case Wheel(name) =&gt; println(s"Visiting $name wheel")
case Body() =&gt; println("Visiting Body")
case Engine() =&gt; println("Visiting Engine")
case Car() =&gt; println("Visiting Car")
</code></pre>

<p>  }</p>

<p>  val doVisitor: Visitor = {</p>

<pre><code>case Wheel(name) =&gt; println(s"Kicking my $name wheel")
case Body() =&gt; println("Moving my body")
case Engine() =&gt; println("Starting my engine")
case Car() =&gt; println("Starting my car")
</code></pre>

<p>  }
}
```</p>

<p>ä¸Šé¢è¿™ä¸€æ®µå®šä¹‰äº†ä¸€ä¸ªå«åšVisitorçš„typeï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå‡½æ•°ç­¾åã€‚ä»»ä½•æ¥å—ä¸€ä¸ªæ±½è½¦éƒ¨ä»¶ä½œä¸ºå‚æ•°å¹¶ä¸”æ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°éƒ½ç¬¦åˆå®ƒçš„ç­¾åï¼Œä¹Ÿå°±å¯ä»¥è¢«è§†ä½œVisitorã€‚</p>

<p>æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªç¬¦åˆVisitorç­¾åçš„å‡½æ•°ï¼Œéƒ½æ˜¯ç”¨pattern matchå®ç°çš„ã€‚</p>

<p>pattern matchè¿™ç§ç¥å¥‡çš„è¯­è¨€ç‰¹æ€§æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸèƒŒåçš„åŸå› å¹¶ä¸ç¥å¥‡ï¼Œæ›´å¤šè¯¦æƒ…è¯·å‚è€ƒæˆ‘ä¹‹å‰çš„å¦ä¸€ç¯‡åšå®¢ï¼š<a href="http://cuipengfei.me/blog/2013/12/29/desugar-scala-8/">http://cuipengfei.me/blog/2013/12/29/desugar-scala-8/</a></p>

<p>```scala
object VisitorDemo {
  def main(args: Array[String]) {</p>

<pre><code>val car = Car()
car.accept(printVisitor)
car.accept(doVisitor)
</code></pre>

<p>  }
}
```</p>

<p>æœ€åå®šä¹‰ä¸€ä¸ªmainå‡½æ•°ï¼Œä¸Javaçš„mainå‡½æ•°åšçš„äº‹æƒ…æ˜¯ç­‰ä»·çš„ã€‚</p>

<p>è¿™æ ·ï¼Œ100è¡Œå˜æˆäº†45è¡Œã€‚Visitorä¸å†ä½œä¸ºè‡ƒè‚¿çš„å®ä½“å­˜åœ¨ï¼Œè€Œåªæ˜¯å‡½æ•°ã€‚</p>

<p>è€Œä¸”å¦‚æœéµç…§åŒæ ·çš„å‡è®¾ï¼Œè®¤ä¸ºè½¦çš„éƒ¨ä»¶æ˜¯ç¨³å®šçš„ï¼Œè€Œè®¿é—®è€…æ˜¯ä¼šå¢å¤šçš„ï¼Œé‚£è¿™æ®µScalaä»£ç çš„å¢é•¿è¶‹åŠ¿æ˜¯æ¯åŠ ä¸€ä¸ªè®¿é—®è€…å°±åŠ ä¸€ä¸ªå‡½æ•°ã€‚ä¸Javaä»£ç çš„å¢é•¿è¶‹åŠ¿ç›¸åŒã€‚</p>

<h1>ç»“è¯­</h1>

<p>è¿™æ¬¡åˆ†æçš„è®¿é—®è€…æ¨¡å¼å’Œä¹‹å‰çš„ä¸€äº›æ¨¡å¼å¾ˆç±»ä¼¼ï¼Œå½“æˆ‘ä»¬éœ€è¦çš„å®ä½“ä»…ä»…æ˜¯ä½œä¸ºæ‰¿è½½æŸç§è¡Œä¸ºçš„ä¸€ä¸ªè½½å…·ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘å°†å®ä½“æ¶ˆå»ï¼Œè€Œæ¢ç”¨å‡½æ•°è¿™ç§æ›´ç®€å•ï¼Œæ›´è½»é‡çº§çš„æŠ½è±¡æ–¹å¼æ¥å®ç°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚</p>

<p>å½“å¹´OOæ¨¡å¼å‡ºç°çš„æ—¶å€™ï¼ŒFPå¹¶ä¸ç››è¡Œï¼ŒåŸä½œè€…æå‡ºçš„æ–¹æ¡ˆæ— å¯åšéã€‚ä¸è¿‡æˆ‘ä»¬ä»Šå¤©æœ‰äº†FPè¿™ç§æ›´è¶æ‰‹çš„å·¥å…·ï¼Œå°±å¯ä»¥è€ƒè™‘åœ¨åˆé€‚çš„æ—¶å€™å°†å…¶ä¸OOç»“åˆä½¿ç”¨æ¥è¾¾åˆ°æ›´å¥½çš„è®¾è®¡çš„ç›®çš„ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è§‚å¯Ÿè€…æ¨¡å¼ in FPï¼šMutation vs Transformation]]></title>
    <link href="http://cuipengfei.github.com/blog/2015/06/13/observers-pattern-fp/"/>
    <updated>2015-06-13T22:49:00+05:30</updated>
    <id>http://cuipengfei.github.com/blog/2015/06/13/observers-pattern-fp</id>
    <content type="html"><![CDATA[<h1>è§‚å¯Ÿè€…æ¨¡å¼</h1>

<blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆæœ‰æ—¶åˆè¢«ç§°ä¸ºå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼‰æ˜¯è½¯ä»¶è®¾è®¡æ¨¡å¼çš„ä¸€ç§ã€‚åœ¨æ­¤ç§æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªç›®æ ‡å¯¹è±¡ç®¡ç†æ‰€æœ‰ç›¸ä¾äºå®ƒçš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨å®ƒæœ¬èº«çš„çŠ¶æ€æ”¹å˜æ—¶ä¸»åŠ¨å‘å‡ºé€šçŸ¥ã€‚è¿™é€šå¸¸é€è¿‡å‘¼å«å„è§‚å¯Ÿè€…æ‰€æä¾›çš„æ–¹æ³•æ¥å®ç°ã€‚æ­¤ç§æ¨¡å¼é€šå¸¸è¢«ç”¨æ¥å®ä½œäº‹ä»¶å¤„ç†ç³»ç»Ÿã€‚</p></blockquote>

<p>ä»¥ä¸Šæ˜¯wikiå¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„è§£é‡Šã€‚</p>

<p>ä¸¾ä¸€ä¸ªã€ŠHead first design patternã€‹ä¸­çš„ä¾‹å­ï¼š</p>

<p>æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªæ°”è±¡ç«™ï¼Œæ¯å½“æ°”è±¡æœ‰å˜åŒ–çš„æ—¶å€™å°±éœ€è¦æ˜¾ç¤ºå½“å‰å¤©æ°”ã€‚
éœ€è¦æ˜¾ç¤ºå†å²å¹³å‡æ°”æ¸©ï¼Œæœ€é«˜æ°”æ¸©å’Œæœ€ä½æ°”æ¸©ã€‚
è¿˜éœ€è¦æ ¹æ®æ°”å‹é¢„æµ‹æ™´é›¨ã€‚</p>

<p>è¿™ç§æƒ…å†µå°±å¾ˆé€‚åˆä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ¯ç§éœ€è¦æ˜¾ç¤ºæ°”è±¡çš„è£…ç½®ä½œä¸ºè§‚å¯Ÿè€…ï¼Œæ°”è±¡æ•°æ®æœ¬èº«ä½œä¸ºå¯ä»¥è¢«è§‚å¯Ÿçš„å¯¹è±¡ã€‚
æ¯å½“æ°”è±¡å˜åŒ–çš„æ—¶å€™ï¼Œè¢«è§‚å¯Ÿçš„å¯¹è±¡å°±ä¼šé€šçŸ¥è§‚å¯Ÿè€…æ¥æ ¹æ®æ–°çš„æ•°æ®ä½œå‡ºæ–°çš„æ˜¾ç¤ºã€‚</p>

<p>ä»¥ä¸‹æ˜¯ä¹¦ä¸­ç»™å‡ºçš„ä»£ç ï¼š</p>

<h1>Java</h1>

<p>```java
public interface Observer {</p>

<pre><code>void update(float temp, float humidity, float pressure);
</code></pre>

<p>}</p>

<p>public interface Subject {</p>

<pre><code>void registerObserver(Observer o);

void notifyObservers();
</code></pre>

<p>}
```</p>

<p>é¦–å…ˆå®šä¹‰ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯è§‚å¯Ÿè€…ï¼Œæ¥æ”¶æ–°çš„æ°”è±¡æ•°æ®ã€‚ä¸€ä¸ªæ˜¯è¢«è§‚å¯Ÿè€…ï¼Œå¯ä»¥æ³¨å†Œè§‚å¯Ÿè€…ä»¥åŠé€šçŸ¥è§‚å¯Ÿè€…ã€‚</p>

<p>```java
public class WeatherData implements Subject {</p>

<pre><code>private ArrayList&lt;Observer&gt; observers = new ArrayList&lt;&gt;();
private float temperature;
private float humidity;
private float pressure;

public void registerObserver(Observer o) {
    observers.add(o);
}

public void notifyObservers() {
    for (Observer observer : observers) {
        observer.update(temperature, humidity, pressure);
    }
}

public void setMeasurements(float temperature, float humidity, float pressure) {
    this.temperature = temperature;
    this.humidity = humidity;
    this.pressure = pressure;
    notifyObservers();
}
</code></pre>

<p>}
```</p>

<p>æ¥ä¸‹æ¥å®šä¹‰æ°”è±¡æ•°æ®æœ¬èº«ã€‚ä»£ç å¾ˆå®¹æ˜“ç†è§£ï¼ŒæŠŠè§‚å¯Ÿè€…ä¿å­˜åœ¨ä¸€ä¸ªlisté‡Œï¼Œæ¯å½“æ°”è±¡æ•°æ®å˜åŒ–çš„æ—¶å€™å°±é€šçŸ¥è¿™äº›è§‚å¯Ÿè€…å»åšå‡ºæ–°çš„å¤„ç†ã€‚</p>

<p>```java
public class CurrentConditionsDisplay implements Observer {</p>

<pre><code>public CurrentConditionsDisplay(Subject weatherData) {
    weatherData.registerObserver(this);
}

public void update(float temperature, float humidity, float pressure) {
    System.out.println("Current conditions: " + temperature
            + "F degrees and " + humidity + "% humidity");
}
</code></pre>

<p>}</p>

<p>public class StatisticsDisplay implements Observer {</p>

<pre><code>private float maxTemp = 0.0f;
private float minTemp = 200;
private float tempSum = 0.0f;
private int numReadings;

public StatisticsDisplay(WeatherData weatherData) {
    weatherData.registerObserver(this);
}

public void update(float temp, float humidity, float pressure) {
    tempSum += temp;
    numReadings++;

    if (temp &gt; maxTemp) {
        maxTemp = temp;
    }

    if (temp &lt; minTemp) {
        minTemp = temp;
    }

    System.out.println("Avg/Max/Min temperature = " + (tempSum / numReadings)
            + "/" + maxTemp + "/" + minTemp);
}
</code></pre>

<p>}</p>

<p>public class ForecastDisplay implements Observer {</p>

<pre><code>private float currentPressure = 29.92f;
private float lastPressure;

public ForecastDisplay(WeatherData weatherData) {
    weatherData.registerObserver(this);
}

public void update(float temp, float humidity, float pressure) {
    lastPressure = currentPressure;
    currentPressure = pressure;

    System.out.print("Forecast: ");
    if (currentPressure &gt; lastPressure) {
        System.out.println("Improving weather on the way!");
    } else if (currentPressure == lastPressure) {
        System.out.println("More of the same");
    } else if (currentPressure &lt; lastPressure) {
        System.out.println("Watch out for cooler, rainy weather");
    }
}
</code></pre>

<p>}
```</p>

<p>ç„¶åæœ‰ä¸‰ä¸ªè§‚å¯Ÿè€…ï¼Œåˆ†åˆ«è´Ÿè´£æ˜¾ç¤ºå½“å‰æ°”è±¡ï¼Œæ°”è±¡å†å²åˆ†æå’Œæ™´é›¨é¢„æµ‹ã€‚</p>

<p>CurrentConditionsDisplayæ˜¯æœ€ç®€å•çš„ï¼Œæ²¡æœ‰ä»»ä½•çŠ¶æ€ï¼Œå®ƒåªæ˜¯è´Ÿè´£åœ¨æ¯æ¬¡æ°”è±¡æœ‰å˜åŒ–çš„æ—¶å€™æŠŠæœ€æ–°çš„æ°”è±¡æ˜¾ç¤ºå‡ºæ¥ã€‚</p>

<p>StatisticsDisplayå¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå®ƒéœ€è¦è®°å½•å†å²æ°”æ¸©ï¼Œä»¥ä¾¿äºè®¡ç®—å¹³å‡æ¸©åº¦ï¼Œæœ€é«˜å’Œæœ€ä½æ°”æ¸©ã€‚è¿™æ˜¯ä¸€ä¸ªä¼šæœ‰çŠ¶æ€å˜åŒ–çš„å¯¹è±¡ã€‚</p>

<p>ForecastDisplayä¹Ÿæœ‰çŠ¶æ€å˜åŒ–ï¼Œå®ƒéœ€è¦è®°å½•ä¸Šæ¬¡çš„æ°”å‹ï¼Œä»¥ä¾¿äºæ ¹æ®æ°”å‹å˜åŒ–æ¥é¢„æµ‹æ™´é›¨ã€‚</p>

<p>```java
public class WeatherStation {</p>

<pre><code>public static void main(String[] args) {
    WeatherData weatherData = new WeatherData();
    CurrentConditionsDisplay currentDisplay = new CurrentConditionsDisplay(weatherData);
    StatisticsDisplay statisticsDisplay = new StatisticsDisplay(weatherData);
    ForecastDisplay forecastDisplay = new ForecastDisplay(weatherData);

    weatherData.setMeasurements(80, 65, 30.4f);
    weatherData.setMeasurements(82, 70, 29.2f);
    weatherData.setMeasurements(78, 90, 29.2f);
}
</code></pre>

<p>}
```</p>

<p>æœ€åï¼Œæœ‰ä¸€ä¸ªmainå‡½æ•°ï¼ŒæŠŠä»¥ä¸Šæ‰€æœ‰ä»£ç ä¸²èµ·æ¥ã€‚</p>

<p>ä¸‰ä¸ªè§‚å¯Ÿè€…éƒ½åœ¨è§‚å¯ŸåŒä¸€ä¸ªæ°”è±¡æ•°æ®ï¼Œæ¯å½“æ°”è±¡æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œä¸‰ä¸ªè§‚å¯Ÿè€…éƒ½ä¼šè¢«é€šçŸ¥ï¼Œå¹¶ä½œå‡ºç›¸åº”å¤„ç†ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬éœ€è¦å…¶ä»–çš„æ›´å¤æ‚çš„æ°”è±¡æ˜¾ç¤ºè£…ç½®ï¼Œåªéœ€è¦å®ç°Observeræ¥å£ï¼Œæ³¨å†Œåˆ°æ°”è±¡æ•°æ®ä¸Šå»ï¼Œé‚£ä¹ˆåœ¨æ¯æ¬¡æ°”è±¡æœ‰å˜åŒ–çš„æ—¶å€™å°±å¯ä»¥æ”¶åˆ°é€šçŸ¥å¹¶ä½œå‡ºå¤„ç†ã€‚ä¸éœ€è¦å¯¹å·²æœ‰ä»£ç åšå‡ºä»»ä½•æ”¹å˜ã€‚</p>

<p>å¾ˆçµæ´»ï¼Œå¾ˆå¼ºå¤§ï¼Œå¯¹å§ï¼Ÿ</p>

<h2>ä¸è¿‡å†æƒ³ä¸€ä¸‹</h2>

<p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰æ²¡æœ‰æ›´å¥½åœ°å®ç°æ–¹å¼å‘¢ï¼Ÿ</p>

<p>ç­”æ¡ˆè‚¯å®šæ˜¯æœ‰çš„ã€‚</p>

<p>C#çš„delegateå’ŒEventå°±æ˜¯ä¸€ç§ç”¨æ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„å¾ˆå¥½çš„è¯­è¨€ç‰¹æ€§ã€‚å®ƒåœ¨è¯­è¨€çº§åˆ«ä¸ºæ·»åŠ äº‹ä»¶è®¢é˜…å’Œå–æ¶ˆè®¢é˜…æä¾›äº†æ”¯æŒã€‚</p>

<p>ä¸è¿‡è¿™ä¸€ç¯‡åšå®¢ä¸»è¦æ˜¯æƒ³è¦è®²ä¸€ä¸ªimmutableçš„è§‚å¯Ÿè€…æ¨¡å¼å®ç°ï¼ŒC#å°±ä¸å¤šè®²äº†ã€‚</p>

<p>å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œä¸Šé¢çš„Javaä»£ç é‡Œçš„ä¸‰ä¸ªè§‚å¯Ÿè€…ï¼ŒCurrentConditionsDisplayæ˜¯æ²¡æœ‰ä»»ä½•çŠ¶æ€å˜åŒ–çš„ï¼Œå®ƒå­˜åœ¨çš„æ„ä¹‰ä»…åœ¨äºå…¶updateæ–¹æ³•ã€‚
è€Œè¿™ä¸ªæ–¹æ³•æ¯æ¬¡éƒ½æ˜¯æ¥å—æœ€æ–°çš„æ°”è±¡æ•°æ®ï¼Œå¹¶ä½œå‡ºè¾“å‡ºã€‚</p>

<p>StatisticsDisplayå’ŒForecastDisplayåˆ™æ˜¯æˆªå–æ°”è±¡å†å²æ•°æ®ä¸åŒçš„ç‰‡æ®µï¼Œå°†å…¶ä½œä¸ºå¯å˜çŠ¶æ€å°è£…åœ¨å†…éƒ¨ï¼Œå¹¶æ®å…¶çŠ¶æ€çš„æ”¹å˜å†³å®šupdateæ–¹æ³•çš„è¡Œä¸ºã€‚</p>

<p>è¿™æ ·çœ‹æ¥ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥æä¾›å®Œæ•´çš„æ°”è±¡æ•°æ®å†å²ï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªè§‚å¯Ÿè€…å°±éƒ½å¯ä»¥å„å–æ‰€éœ€ï¼Œè€Œä¸éœ€è¦æ‹¥æœ‰è‡ªå·±çš„å¯å˜çŠ¶æ€äº†ã€‚</p>

<p>å…·ä½“è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>

<h1>functions</h1>

<p>ä»¥ä¸‹æ˜¯Scalaçš„å®ç°ï¼š</p>

<p>```scala
case class WeatherData(temperature: Float = 0,</p>

<pre><code>                   humidity: Float = 0,
                   pressure: Float = 0,
                   observers: Seq[Observer] = Nil,
                   history: Seq[WeatherData] = Seq(WeatherData(history = Nil))) {
</code></pre>

<p>  def register(observer: Observer) =</p>

<pre><code>this.copy(temperature, humidity, pressure, observers :+ observer, history)
</code></pre>

<p>  def weatherChanged(weatherData: WeatherData) = {</p>

<pre><code>val newHistory = history :+ weatherData
observers.foreach(observer =&gt; observer(newHistory))
this.copy(temperature, humidity, pressure, observers, newHistory)
</code></pre>

<p>  }
}</p>

<p>object Observers {
  type Observer = Seq[WeatherData] => Unit</p>

<p>  val currentConditionsDisplay: Observer = history =></p>

<pre><code>println(s"Current conditions: " +
  s"${history.last.temperature} F degrees and " +
  s"${history.last.humidity} % humidity")
</code></pre>

<p>  val statisticsDisplay: Observer = history =></p>

<pre><code>println(s"Avg/Max/Min temperature = " +
  s"${history.map(_.temperature).sum / history.size}" +
  s"/${history.map(_.temperature).max}" +
  s"/${history.map(_.temperature).max}")
</code></pre>

<p>  val forecastDisplay: Observer = history => {</p>

<pre><code>val currentPressure = history.last.pressure
val lastPressure = history.dropRight(1).last.pressure

print("Forecast: ")
if (currentPressure &gt; lastPressure) println("Improving weather on the way!")
else if (currentPressure == lastPressure) println("More of the same")
else if (currentPressure &lt; lastPressure) println("Watch out for cooler, rainy weather")
</code></pre>

<p>  }
}</p>

<p>object WeatherStation {
  def main(args: Array[String]) {</p>

<pre><code>val weatherData = WeatherData()
  .register(currentConditionsDisplay)
  .register(statisticsDisplay)
  .register(forecastDisplay)

weatherData
  .weatherChanged(WeatherData(80, 65, 30.4f))
  .weatherChanged(WeatherData(82, 70, 29.2f))
  .weatherChanged(WeatherData(78, 90, 29.2f))
</code></pre>

<p>  }
}
```</p>

<p>ä»¥ä¸Šå°±æ˜¯Scalaå®ç°çš„å…¨éƒ¨ä»£ç äº†ã€‚</p>

<p>å¼€å§‹åˆ†æä¹‹å‰ï¼Œå…ˆåšä¸€ä¸ªæå…¶å¤æ‚çš„æ•°å­¦è¿ç®—ï¼š
106è¡Œçš„Javaä»£ç ï¼Œç­‰ä»·äº54è¡ŒScalaä»£ç ã€‚
7ä¸ªç±»ï¼Œå˜æˆäº†3ä¸ªã€‚</p>

<p>ä¸‹é¢å¼€å§‹æ­£ç»çš„åˆ†æã€‚</p>

<p>é¦–å…ˆæœ‰ä¸€ä¸ªå«åšWeatherDataçš„case classï¼Œå®ƒæ˜¯å®Œå…¨ä¸å¯å˜çš„ã€‚</p>

<p>å…¶registeræ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªæ–°çš„Observerä½œä¸ºå‚æ•°ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„åŒ…å«æ¯”åŸæ¥å¤šä¸€ä¸ªObserverçš„WeatherDataå®ä¾‹ã€‚</p>

<p>å…¶weatherChangedæ–¹æ³•æ¥å—ä¸€ä¸ªæ–°çš„æ°”è±¡æ•°æ®ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å†å²æ•°æ®Seqï¼Œå¹¶æŠŠç›®å‰ä¸ºæ­¢åŒ…å«æ‰€æœ‰å†å²æ°”è±¡æ•°æ®çš„Seqä¼ é€’ç»™æ¯ä¸€ä¸ªObserverå»åšå¤„ç†ã€‚æœ€åè¿”å›ä¸€ä¸ªåŒ…å«æœ€æ–°å†å²æ•°æ®çš„æ–°çš„WeatherDataå®ä¾‹ã€‚</p>

<p>é‚£ä¹ˆè¿™äº›Observerå…·ä½“æ˜¯æ€ä¹ˆå®šä¹‰çš„å‘¢ï¼Ÿ</p>

<p>é¦–å…ˆObserveråªæ˜¯ä¸€ä¸ªtypeï¼Œä¸æ˜¯ä¸€ä¸ªclassï¼Œå®ƒæ˜¯æ²¡æœ‰çŠ¶æ€çš„ï¼Œç”¨æ¥å®šä¹‰å‡½æ•°ç­¾åã€‚</p>

<p>ä¸‰ä¸ªå…·ä½“çš„displayä»…ä»…æ˜¯ä¸‰ä¸ªç¬¦åˆObserverç­¾åçš„å‡½æ•°ï¼Œå®ƒä»¬éƒ½æ¥å—æ°”è±¡å†å²æ•°æ®ä½œä¸ºå‚æ•°ï¼Œåœ¨å†å²æ•°æ®ä¸­å„å–æ‰€éœ€ï¼Œä½œå‡ºå¤„ç†ã€‚éƒ½æ˜¯æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨çš„ã€‚
è¿™å¾ˆåˆç†ï¼Œæ¯•ç«Ÿåªæ˜¯displayï¼Œä»…éœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†æå’Œæ˜¾ç¤ºï¼Œåªè¯»ä¸å†™ï¼Œæ²¡æœ‰ä»€ä¹ˆè¦æ”¹å˜å·²æœ‰æ•°æ®çš„å¿…è¦æ€§ã€‚</p>

<p>æœ€åä¸€ä¸ªmainå‡½æ•°æŠŠæ‰€æœ‰ä»£ç ä¸²èµ·æ¥ï¼Œå°±å¾—åˆ°äº†ä¸€ä»½æ²¡æœ‰ä»»ä½•å¯å˜æ€§çš„ä»£ç ã€‚</p>

<h1>Mutation vs Transformation</h1>

<p>åœ¨Javaç‰ˆçš„ä»£ç ä¸­ï¼Œä¸åŒçš„æ˜¾ç¤ºè®¾å¤‡ä¸æ–­åœ°æ ¹æ®æœ€æ–°çš„æ°”è±¡æ•°æ®æ”¹å˜è‡ªå·±çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®æ”¹å˜ä¹‹åçš„çŠ¶æ€æ¥å†³å®šå…¶updateçš„è¡Œä¸ºã€‚</p>

<p>è€Œåœ¨Scalaä»£ç ä¸­ï¼Œä¸åŒçš„æ˜¾ç¤ºè®¾å¤‡æ²¡æœ‰çŠ¶æ€ï¼Œå®ƒä»¬éƒ½ä»…ä»…æ˜¯å‡½æ•°è€Œå·²ã€‚å®ƒä»¬åœ¨æ¯æ¬¡æ°”è±¡å˜åŒ–æ—¶æ ¹æ®å…¨éƒ¨æ°”è±¡å†å²æ•°æ®å†³å®šè‡ªå·±çš„è¡Œä¸ºã€‚</p>

<p>å…¨éƒ¨ä»£ç ä¸­æ²¡æœ‰é‡æ–°èµ‹å€¼è¯­å¥ï¼Œæ‰€æœ‰çš„èµ‹å€¼æ“ä½œéƒ½æ˜¯å¯¹å±€éƒ¨å˜é‡çš„èµ‹å€¼ï¼Œç¨‹åºå‘˜å¯ä»¥æ„ŸçŸ¥åˆ°çš„å˜åŒ–å°±åªåœ¨äºobserversåˆ—è¡¨å’Œhistoryåˆ—è¡¨çš„å¢é•¿ã€‚è€Œå³ä¾¿æ˜¯è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„çš„å¢é•¿éƒ½æ˜¯é€šè¿‡ä¸æ–­ç”Ÿæˆæ–°çš„ä¸å¯å˜çš„Seqæ¥å®ç°çš„ã€‚</p>

<p>æ€»ç»“æ¥è¯´ï¼ŒJavaç‰ˆä»£ç é€šè¿‡æ”¹å˜å·²æœ‰æ•°æ®æ¥è¾¾æˆè¡Œä¸ºçš„æ”¹å˜ã€‚è€ŒScalaä»£ç åˆ™é€šè¿‡åˆ©ç”¨ä¸å¯å˜çš„å‡½æ•°å’Œä¸æ–­ç”Ÿæˆä¸å¯å˜çš„æ•°æ®æ¥å®ç°è¡Œä¸ºçš„æ”¹å˜ã€‚</p>

<p>è¿™ç§ä¸å¯å˜çš„ä»£ç äºä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ</p>

<p>å…¶å¥½å¤„åœ¨äºéœ€è¦ç¨‹åºå‘˜æ“å¿ƒçš„äº‹æƒ…æ›´å°‘ã€‚å˜åŒ–çš„ç‚¹è¶Šå°‘ï¼Œéº»çƒ¦äº‹è¶Šå°‘ã€‚</p>

<p>å¦‚æœä»¥ä¸Šçš„Javaä»£ç æœ‰é—®é¢˜ï¼Œç¨‹åºå‘˜é™¤äº†éœ€è¦æ£€æŸ¥è®¡ç®—å¹³å‡æ°”æ¸©ï¼Œæœ€é«˜æœ€ä½æ°”æ¸©ï¼Œæ°”å‹å˜åŒ–çš„ç®—æ³•ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ£€æŸ¥é‡æ–°èµ‹å€¼è¯­å¥æ‰€é€ æˆçš„æ•ˆæœã€‚æ°”æ¸©çš„sumæ˜¯å¦ç®—å¯¹äº†ï¼Ÿæµ‹æ¸©æ¬¡æ•°æ˜¯å¦ç®—é”™äº†ï¼Ÿæ°”å‹å˜åŒ–æ˜¯å¦è®°å½•å¯¹äº†ï¼Ÿè¿™äº›éƒ½æ˜¯å˜åŒ–çš„ç‚¹ï¼Œè¿™äº›éƒ½æ˜¯å¯¼è‡´é”™è¯¯çš„å¯èƒ½æ€§ä¹‹æ‰€åœ¨ã€‚</p>

<p>è€Œåœ¨Scalaä»£ç ä¸­ï¼Œå¦‚æœä»£ç æœ‰é—®é¢˜ï¼ŒåŒæ ·éœ€è¦æ£€æŸ¥ç®—æ³•çš„æ­£ç¡®æ€§ï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥ä¸å¯å˜çš„å‡½æ•°çš„æ­£ç¡®æ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåªéœ€è¦æ£€æŸ¥historyåˆ—è¡¨çš„å¢é•¿å°±å¯ä»¥äº†ã€‚è€Œä¸€ä¸ªåˆ—è¡¨çš„å¢é•¿æ˜¯å¾ˆéš¾å‡ºé”™çš„ã€‚</p>

<p>Javaä¸­æ‰€æœ‰å¯¹è±¡çŠ¶æ€çš„æ”¹å˜åˆ†æ•£åœ¨ä»£ç ä¸­ä¸åŒçš„åœ°æ–¹ï¼Œåˆ°äº†Scalaä»£ç ä¸­å®ƒä»¬éƒ½é›†ä¸­åˆ°äº†ä¸€ä¸ªåˆ—è¡¨çš„å¢é•¿ä¸Šï¼Œä»…ä»…é€šè¿‡å¯¹è¿™ä¸ªåˆ—è¡¨çš„transformationå°±é©±åŠ¨äº†å…¶ä½™å…¨éƒ¨ä»£ç çš„è¡Œä¸ºæ”¹å˜ã€‚å‡å°‘äº†å˜åŒ–çš„ç‚¹ï¼Œå°±å‡å°‘äº†å‡ºé”™çš„å¯èƒ½æƒ…å†µçš„æ•°é‡ï¼Œå‡å°‘äº†ç¨‹åºå‘˜çš„è´Ÿæ‹…ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è§£é‡Šå™¨æ¨¡å¼ï¼šOOP versus Functional Decomposition]]></title>
    <link href="http://cuipengfei.github.com/blog/2015/06/05/interpreter-pattern-oop-versus-functional-decomposition/"/>
    <updated>2015-06-05T15:34:00+05:30</updated>
    <id>http://cuipengfei.github.com/blog/2015/06/05/interpreter-pattern-oop-versus-functional-decomposition</id>
    <content type="html"><![CDATA[<h1>è§£é‡Šå™¨æ¨¡å¼</h1>

<blockquote><p>In computer programming, the interpreter pattern is a design pattern that specifies how to evaluate sentences in a language. The basic idea is to have a class for each symbol (terminal or nonterminal) in a specialized computer language. The syntax tree of a sentence in the language is an instance of the composite pattern and is used to evaluate (interpret) the sentence for a client.</p></blockquote>

<p>ä»¥ä¸Šæ˜¯wikiå¯¹è§£é‡Šå™¨æ¨¡å¼çš„æè¿°ã€‚</p>

<p>è¿™æ˜¯ä¸€ä¸ªå­¦æœ¯æ€§ç¨å¼ºçš„æ¨¡å¼ï¼Œä¸å¤ªå¥½æ‰¾åˆ°ç”Ÿæ´»åŒ–çš„æ¯”å–»ã€‚</p>

<p>å°±ç›´æ¥ä¸Šä»£ç å§ã€‚</p>

<h1>Java</h1>

<p>```java
interface Expression {</p>

<pre><code>int interpret(Map&lt;String, Expression&gt; variables);
</code></pre>

<p>}
```</p>

<p>é¦–å…ˆæœ‰ä¸€ä¸ªè¡¨è¾¾å¼çš„æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ªæ±‚å€¼çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªString -> Expressionçš„mapã€‚</p>

<p>å¯ä»¥çŒœåˆ°ï¼Œè¿™ä¸ªmapå°±æ˜¯è¯¥è¡¨è¾¾å¼æ±‚å€¼çš„æ—¶å€™éœ€è¦ç”¨åˆ°çš„contextã€‚</p>

<p>```java
class Plus implements Expression {</p>

<pre><code>Expression leftOperand;
Expression rightOperand;

public Plus(Expression left, Expression right) {
    leftOperand = left;
    rightOperand = right;
}

public int interpret(Map&lt;String, Expression&gt; variables) {
    return leftOperand.interpret(variables) + rightOperand.interpret(variables);
}
</code></pre>

<p>}</p>

<p>class Minus implements Expression {</p>

<pre><code>Expression leftOperand;
Expression rightOperand;

public Minus(Expression left, Expression right) {
    leftOperand = left;
    rightOperand = right;
}

public int interpret(Map&lt;String, Expression&gt; variables) {
    return leftOperand.interpret(variables) - rightOperand.interpret(variables);
}
</code></pre>

<p>}</p>

<p>class Number implements Expression {</p>

<pre><code>private int number;

public Number(int number) {
    this.number = number;
}

public int interpret(Map&lt;String, Expression&gt; variables) {
    return number;
}
</code></pre>

<p>}</p>

<p>class Variable implements Expression {</p>

<pre><code>private String name;

public Variable(String name) {
    this.name = name;
}

public int interpret(Map&lt;String, Expression&gt; variables) {
    if (null == variables.get(name)) return 0;
    return variables.get(name).interpret(variables);
}
</code></pre>

<p>}
```</p>

<p>ç„¶åæœ‰è¡¨è¾¾å¼çš„å››ä¸ªå®ç°ç±»ï¼šåŠ æ³•è¡¨è¾¾å¼ï¼Œå‡æ³•è¡¨è¾¾å¼ï¼Œæ•°å­—è¡¨è¾¾å¼ï¼Œè¿˜æœ‰å˜é‡ã€‚</p>

<p>æ•°å­—è¡¨è¾¾å¼åœ¨æ±‚å€¼çš„æ—¶å€™å°±ç›´æ¥è¿”å›å®ƒè¢«åˆ›å»ºæ—¶æ‹¿åˆ°çš„æ•°å­—å°±å¥½äº†ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ã€‚</p>

<p>åŠ æ³•å’Œå‡æ³•çš„interpretæ–¹æ³•åœ¨æ±‚å€¼çš„æ—¶å€™ä»…ä»…æ˜¯æŠŠè¡Œä¸ºå§”æ‰˜ç»™äº†ä¸¤ä¸ªå­è¡¨è¾¾å¼ï¼Œå†å¯¹å­è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœåšåŠ å‡æ³•ã€‚</p>

<p>å˜é‡åœ¨æ±‚å€¼çš„æ—¶å€™åˆ™æ˜¯å»contexté‡Œé¢å¯»æ‰¾å…¶nameå¯¹åº”çš„è¡¨è¾¾å¼ï¼ˆä¹Ÿå°±æ˜¯å®ƒæ‰€æŒ‡å‘çš„è¡¨è¾¾å¼ï¼‰ï¼Œç„¶åå¯¹å…¶æ±‚å€¼ã€‚</p>

<p>ä¸‹é¢æ˜¯å¯¹å®ƒä»¬çš„ç»“åˆä½¿ç”¨ï¼š</p>

<p>```java
public class InterpreterExample {</p>

<pre><code>public static void main(String[] args) {
    Map&lt;String, Expression&gt; context = new HashMap&lt;&gt;();
    context.put("w", new Number(5));
    context.put("x", new Number(10));
    context.put("z", new Number(42));

    Plus expr = new Plus(new Variable("w"),
            new Minus(new Variable("x"),
                    new Variable("z")));

    System.out.println(expr.interpret(context));
}
</code></pre>

<p>}
```</p>

<p>é¦–å…ˆæ„é€ ä¸€ä¸ªcontextï¼Œé‡Œé¢æœ‰wï¼Œxï¼Œzä¸‰ä¸ªæ•°å­—ã€‚ç„¶åè®¡ç®—w+(x-z)çš„å€¼ï¼ˆçœ‹ç€åƒä¸åƒLispï¼Ÿï¼‰ã€‚</p>

<h2>ä¸è¿‡å†æƒ³ä¸€ä¸‹</h2>

<p>è¿™äº›ä»£ç å®é™…åšçš„æ˜¯ä»€ä¹ˆäº‹å‘¢ï¼Ÿ</p>

<p>å®é™…å°±æ˜¯æŠŠä¸€ä¸ªä»¥é‡åˆ°Numberä¸ºé€€å‡ºæ¡ä»¶çš„é€’å½’ç®—æ³•æ‹†ç¢äº†ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬ä¸æŠŠå®ƒæ‹†ç¢ï¼Œå°±å†™æˆé€’å½’å‡½æ•°ä¼šå¦‚ä½•å‘¢ï¼Ÿ</p>

<h1>functions</h1>

<p>ç”¨Scalaè¯•ç€å®ç°ä¸€ä¸‹ï¼š</p>

<p>```scala
trait Expr</p>

<p>case class Plus(left: Expr, right: Expr) extends Expr</p>

<p>case class Minus(left: Expr, right: Expr) extends Expr</p>

<p>case class Number(n: Int) extends Expr</p>

<p>case class Var(name: String) extends Expr</p>

<p>object ExprEval {
  def eval(expr: Expr, context: Map[String, Expr]): Int = {</p>

<pre><code>expr match {
  case Plus(l, r) =&gt; eval(l, context) + eval(r, context)
  case Minus(l, r) =&gt; eval(l, context) - eval(r, context)
  case Var(name) =&gt; eval(context(name), context)
  case Number(n) =&gt; n
}
</code></pre>

<p>  }</p>

<p>  def main(args: Array[String]) {</p>

<pre><code>val context = Map("w" -&gt; Number(5), "x" -&gt; Number(10), "z" -&gt; Number(42))
val expr = Plus(Var("w"), Minus(Var("x"), Var("z")))
println(eval(expr, context))
</code></pre>

<p>  }
}
```</p>

<p>ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨ä»£ç ï¼Œä¸Javaç‰ˆç­‰ä»·ã€‚
é€’å½’å‡½æ•°å¾ˆå®¹æ˜“çœ‹æ‡‚ï¼Œå…¶é€€å‡ºæ¡ä»¶ä¹Ÿå¾ˆå®¹æ˜“çœ‹å‡ºæ¥ã€‚</p>

<p>69è¡Œä»£ç å˜æˆäº†26è¡Œã€‚</p>

<p>å››ä¸ªcase classä»£è¡¨å››ç§è¡¨è¾¾å¼ï¼Œå…¶ä¸­å¹¶æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œåªæ˜¯ç”¨æ¥ä½œä¸ºæ•°æ®çš„æ‰¿è½½è€…ã€‚</p>

<p>ä¸€ä¸ªevalå‡½æ•°ï¼Œç”¨pattern matchæ¥å¯¹å››ç§è¡¨è¾¾å¼è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p>

<p>ä¸è¿‡è¿™æ¬¡æˆ‘å€’ä¸æ˜¯è¦å®£æ‰¬è¯´è§£é‡Šå™¨æ¨¡å¼å±äºæ˜¯ç”¨ä¸åˆé€‚çš„å·¥å…·è§£å†³é—®é¢˜ã€‚</p>

<p>è€Œæ˜¯è¦ä»‹ç»ä¸¤ç§ç»„ç»‡ä»£ç çš„æ–¹å¼ï¼šæŒ‰è¡Œç»„ç»‡è¿˜æ˜¯æŒ‰åˆ—ç»„ç»‡ã€‚</p>

<h1>æŒ‰è¡Œç»„ç»‡ä»£ç ä¸æŒ‰åˆ—ç»„ç»‡ä»£ç </h1>

<p>æ˜¨å¤©æˆ‘åœ¨çœ‹è§£é‡Šå™¨æ¨¡å¼ï¼Œå‡†å¤‡å†™ä¸€ä¸ªJavaå®ç°ï¼Œå†å†™ä¸€ä¸ªScalaå®ç°ï¼Œå¹¶ä»¥æ­¤æ¥è¾¾åˆ°æˆ‘é»‘Javaçš„é˜´æš—ç›®çš„ã€‚</p>

<p>ä½†æ˜¯çœ‹äº†wikiä¸Šçš„ç¤ºä¾‹ä»£ç åï¼Œé©¬ä¸Šå°±æƒ³èµ·äº†å»å¹´ä¸Šè¿‡çš„ä¸€é—¨MOOCï¼š<a href="https://www.coursera.org/course/proglang">ã€ŠProgramming languagesã€‹</a>ã€‚
ï¼ˆè¿™é—¨è¯¾æ˜¯ç”±åç››é¡¿å¤§å­¦çš„Dan Grossmanæ•™æˆè®²æˆçš„ï¼Œå†…å®¹æå¥½ï¼Œå¼ºçƒˆæ¨èã€‚ï¼‰</p>

<p>è¿™é—¨è¯¾é‡Œæœ‰ä¸€èŠ‚å°±æåˆ°äº†ä¸Šé¢è¯´çš„ä¸¤ç§ç»„ç»‡ä»£ç çš„æ–¹å¼ï¼šæŒ‰è¡Œç»„ç»‡è¿˜æ˜¯æŒ‰åˆ—ç»„ç»‡ã€‚
è¿™èŠ‚è¯¾çš„è§†é¢‘åœ¨è¿™é‡Œï¼š<a href="https://www.youtube.com/watch?v=uEHnI3pq_FM">https://www.youtube.com/watch?v=uEHnI3pq_FMï¼‰</a></p>

<p>æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¸¤ç‰ˆä»£ç ï¼ŒJavaä»£ç æŠŠå¯¹è¡¨è¾¾å¼çš„æ±‚å€¼åˆ†æ•£åœ¨æ¯ä¸ªä¸åŒçš„è¡¨è¾¾å¼ç±»é‡Œã€‚</p>

<p>è€ŒScalaä»£ç æŠŠæ±‚å€¼ä»£ç é›†ä¸­å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œï¼Œpattern matchæ¯ç§è¡¨è¾¾å¼ç±»å‹å¹¶æ±‚å€¼ã€‚</p>

<p>å¦‚æœè¦åšæˆä¸€ä¸ªè¡¨æ ¼çš„è¯ï¼Œå°±æ˜¯è¿™æ ·çš„ï¼š</p>

<p><img src="http://ww2.sinaimg.cn/large/8b1ece2agw1esug8rpnudj207o0bwt8v.jpg" alt="table" /></p>

<p>å…¶ä¸­çš„é—®å·ä»£è¡¨å…·ä½“çš„æ±‚å€¼å®ç°ã€‚</p>

<p>Javaä»£ç æ¨ªå‘ç»„ç»‡ï¼Œæœ‰ä¸€ä¸ªPlusç±»ï¼Œé‡Œé¢æœ‰interpretæ–¹æ³•ï¼Œæœ‰ä¸€ä¸ªMinusç±»ï¼Œé‡Œé¢æœ‰interpretæ–¹æ³•ï¼Œç­‰ç­‰ã€‚è¿™æ˜¯æŒ‰ç…§è¡Œç»„ç»‡ã€‚</p>

<p>è€ŒScalaä»£ç åˆ™çºµå‘ç»„ç»‡ï¼Œæœ‰ä¸€ä¸ªevalå‡½æ•°ï¼Œçºµå‘æŠŠå››ç§è¡¨è¾¾å¼çš„æ±‚å€¼éƒ½åŒ…æ½äº†ã€‚è¿™æ˜¯æŒ‰åˆ—ç»„ç»‡ã€‚</p>

<p>ä¸Šé¢çš„è¡¨æ ¼å¤ªå°ï¼Œçœ‹ç€ä¸æ˜æ˜¾ï¼Œç°åœ¨å‡è®¾æˆ‘ä»¬éœ€è¦æ‰“å°è¡¨è¾¾å¼çš„åŠŸèƒ½ã€‚é‚£ä¹ˆè¡¨æ ¼å°±ä¼šå˜æˆè¿™æ ·ï¼š</p>

<p><img src="http://ww4.sinaimg.cn/large/8b1ece2agw1esugg4y9wij20ba0c43yu.jpg" alt="table2" /></p>

<p>å¯ä»¥æƒ³è±¡ï¼ŒJavaä»£ç é‡Œä¼šåœ¨æ¯ä¸ªè¡¨è¾¾å¼ç±»é‡ŒåŠ ä¸€ä¸ªtoStringå‡½æ•°çš„å®ç°ã€‚æ¨ªå‘æ‰©å±•ï¼Œä¸€ä¸ªç±»æŠŠæ•°æ®å’Œç®—æ³•ç»„ç»‡åœ¨ä¸€èµ·ã€‚</p>

<p>è€Œåœ¨Scalaä»£ç é‡Œåˆ™ä¼šå†™ä¸€ä¸ªtoStringçš„é€’å½’å‡½æ•°ï¼ŒåŒ…æ½æ‰€æœ‰å­—ç¬¦ä¸²æ‰“å°çš„å·¥ä½œã€‚çºµå‘æ‰©å±•ï¼Œä¸€ä¸ªå‡½æ•°å»åˆ†è¾¨æ•°æ®ç±»å‹ï¼Œå¹¶æ®æ­¤é€‰æ‹©è®¡ç®—ç­–ç•¥ã€‚</p>

<h1>OOP versus Functional Decomposition</h1>

<p>é‚£åˆ°åº•å“ªç§ç»„ç»‡æ–¹å¼æ›´å¥½å‘¢ï¼Ÿ</p>

<p>å¹¶æ²¡æœ‰ç¡®å®šçš„ç­”æ¡ˆï¼ŒDan Grossmanæ•™æˆåœ¨è¯¾ç¨‹ä¸­ç»™å‡ºçš„è§£é‡Šæ˜¯è¿™æ ·çš„ï¼š</p>

<blockquote><p>FP and OOP often doing the same thing in exact opposite way: organize the program â€œby rowsâ€ or â€œby columnsâ€.
Which is â€œmost naturalâ€ may depend on what you are doing (e.g., an interpreter vs. a GUI) or personal taste.</p></blockquote>

<p>åˆ°åº•å¦‚ä½•ç»„ç»‡å–å†³äºä½ æƒ³è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚ä½ è¦åšä¸€ä¸ªGUIåº“ï¼Œé‚£ä¹ˆæ•°æ®ä¸ç®—æ³•æ”¾åœ¨ä¸€èµ·ï¼Œäº’ç›¸æ¥è¿‘æ˜¯æœ€è‡ªç„¶çš„ç»„ç»‡æ–¹å¼ã€‚è¿™æ—¶é€‰æ‹©OOPæ˜¯æœ€å¥½çš„è®¾è®¡å†³ç­–ã€‚</p>

<p>è€Œå¦‚æœä½ è¦å®ç°çš„ä¸œè¥¿ç±»ä¼¼äºæœ¬æ–‡ä¸­çš„è§£é‡Šå™¨ï¼Œé‚£ä¹ˆä¸€ä¸ªé€’å½’çš„ç®—æ³•æ¥ç»Ÿä¸€å¤„ç†æ‰€æœ‰è¡¨è¾¾å¼ç±»å‹åˆ™æ˜¯æœ€è‡ªç„¶çš„ã€‚è¿™æ—¶é€‰æ‹©Functional Decompositionæ˜¯æœ€å¥½çš„è®¾è®¡å†³ç­–ã€‚</p>

<h1>ç»“è¯­</h1>

<p>OOPä¸Functional Decompositionï¼Œè¿™äºŒè€…å¹¶ä¸æ˜¯å®Œå…¨å¯¹ç«‹çš„ã€‚</p>

<p>ç†Ÿç»ƒæŒæ¡å¤šç§æŠ½è±¡ä¸ä»£ç ç»„ç»‡æ–¹å¼ï¼Œæ­£ç¡®è¯†åˆ«åº”ç”¨åœºæ™¯ï¼Œæ®æ­¤é€‰æ‹©åˆé€‚çš„èŒƒå¼ï¼Œæˆ–è€…æ˜¯é€‰æ‹©å¤šç§èŒƒå¼ç»“åˆä½¿ç”¨ï¼Œæ‰æ˜¯è¿™ä¸€ç³»åˆ—åšæ–‡çš„çœŸå®ç”¨æ„ã€‚</p>

<p>åªä¸è¿‡ç”±äºä¼ ç»Ÿçš„OOè®¾è®¡æ¨¡å¼è¿‡äºç››è¡Œï¼ŒFPèŒƒå¼æ¥å—åº¦ä¸å¤Ÿï¼Œæ‰ä¼šæœ‰è¿™ä¸€ç³»åˆ—åšæ–‡é»‘Javaï¼Œæ§Scalaçš„è¡¨è±¡ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å‘½ä»¤æ¨¡å¼çš„ä¸çˆ½å°±åƒç”¨æŒ‡ç”²åˆ€åˆ®èƒ¡å­]]></title>
    <link href="http://cuipengfei.github.com/blog/2015/06/01/command-pattern-fp-implementation/"/>
    <updated>2015-06-01T21:51:00+05:30</updated>
    <id>http://cuipengfei.github.com/blog/2015/06/01/command-pattern-fp-implementation</id>
    <content type="html"><![CDATA[<h1>å‘½ä»¤æ¨¡å¼</h1>

<blockquote><p>åœ¨é¢å‘å¯¹è±¡ç¨‹å¼è®¾è®¡çš„èŒƒç•´ä¸­ï¼Œå‘½ä»¤æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°è¯•ä»¥ç‰©ä»¶æ¥ä»£è¡¨å®é™…è¡ŒåŠ¨ã€‚å‘½ä»¤ç‰©ä»¶å¯ä»¥æŠŠè¡ŒåŠ¨(action) åŠå…¶å‚æ•°å°è£…èµ·æ¥ï¼Œäºæ˜¯è¿™äº›è¡ŒåŠ¨å¯ä»¥è¢«ï¼š</p>

<ul>
<li>é‡å¤å¤šæ¬¡</li>
<li>å–æ¶ˆï¼ˆå¦‚æœè¯¥ç‰©ä»¶æœ‰å®ä½œçš„è¯ï¼‰</li>
<li>å–æ¶ˆååˆå†é‡åš</li>
</ul>
</blockquote>

<p>ä»¥ä¸Šæ˜¯wikiå¯¹å‘½ä»¤æ¨¡å¼çš„å®šä¹‰ï¼ˆæœ¯è¯­åƒæ˜¯å°æ¹¾çš„ï¼‰ã€‚</p>

<p>ä¸‹é¢æ˜¯æ¥è‡ªã€ŠHead first design patternsã€‹çš„ä¸€ä¸ªä¾‹å­ï¼š</p>

<p>å‡è®¾ä½ æœ‰å¾ˆå¤šå®¶ç”¨ç”µå™¨ï¼šç”µç¯æ³¡ï¼Œç”µè§†ï¼ŒéŸ³å“ï¼Œè¿˜æœ‰ä¸€ä¸ªæ°´ç–—æµ´ç¼¸ã€‚ï¼ˆå°±æ˜¯æ²¡æœ‰æ‰‹ç”µç­’ï¼‰</p>

<p>æ¯ä¸ªå®¶ç”¨ç”µå™¨éƒ½æœ‰è‡ªå·±çš„å¼€å…³è£…ç½®ï¼Œå¤„äºä¸åŒçš„ä½ç½®ã€‚å¦‚æœä½ æƒ³æŠŠå®ƒä»¬éƒ½å¼€å¯ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ°å»æŒ‰æŒ‰é’®ã€‚</p>

<p>ç°åœ¨ä½ æƒ³è¦æœ‰ä¸€ä¸ªé¥æ§å™¨ï¼Œä¸€é”®å¼€å¯æ‰€æœ‰ç”µå™¨ï¼Œä¸€é”®å…³é—­æ‰€æœ‰ç”µå™¨ã€‚</p>

<p>æˆ–è€…æ˜¯ä¸€é”®å®Œæˆä»»æ„çš„ç”µå™¨æ“ä½œç»„åˆã€‚</p>

<p>æ¯ä¸ªç”µå™¨çš„æ¥å£éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯åˆéœ€è¦å’ŒåŒä¸€ä¸ªé¥æ§å™¨é›†æˆï¼Œäºæ˜¯å‘¢ï¼Œè‚¯å®šè¦æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£äº†ã€‚</p>

<p>äºæ˜¯å°±æœ‰äº†ä¸‹é¢å‘½ä»¤æ¨¡å¼çš„å®ç°ä»£ç ã€‚</p>

<h1>Java</h1>

<p>```java
public class Light {</p>

<pre><code>String location;

public Light(String location) {
    this.location = location;
}

public void on() {
    System.out.println("Light is on");
}

public void off() {
    System.out.println("Light is off");
}
</code></pre>

<p>}</p>

<p>public class TV {</p>

<pre><code>String location;
int channel;

public TV(String location) {
    this.location = location;
}

public void on() {
    System.out.println(location + " TV is on");
}

public void off() {
    System.out.println(location + " TV is off");
}

public void setInputChannel() {
    this.channel = 3;
    System.out.println(location + " TV channel is set for DVD");
}
</code></pre>

<p>}</p>

<p>public class Stereo {</p>

<pre><code>String location;

public Stereo(String location) {
    this.location = location;
}

public void on() {
    System.out.println(location + " stereo is on");
}

public void off() {
    System.out.println(location + " stereo is off");
}
</code></pre>

<p>}</p>

<p>public class Hottub {</p>

<pre><code>boolean on;
int temperature;

public Hottub() {
}

public void on() {
    on = true;
}

public void off() {
    on = false;
}

public void circulate() {
    if (on) {
        System.out.println("Hottub is bubbling!");
    }
}

public void setTemperature(int temperature) {
    if (temperature &gt; this.temperature) {
        System.out.println("Hottub is heating to a steaming " + temperature + " degrees");
    } else {
        System.out.println("Hottub is cooling to " + temperature + " degrees");
    }
    this.temperature = temperature;
}
</code></pre>

<p>}
```</p>

<p>é¦–å…ˆæ˜¯æœ‰å››å¤§ä»¶å®¶ç”¨ç”µå™¨ã€‚å„è‡ªä¹‹é—´æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚</p>

<p>è¿™é‡Œé¢çš„ä»£ç éƒ½æœ‰ç‚¹å‚»ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å°±æƒ³è±¡è¿™éƒ½æ˜¯äº›å¾ˆå¤æ‚çš„ç¡¬ä»¶é€šä¿¡ä¹‹ç±»çš„ä»£ç å°±å¥½äº†ã€‚</p>

<p>```java
public interface Command {</p>

<pre><code>void execute();
</code></pre>

<p>}
```</p>

<p>ç„¶åï¼Œå®šä¹‰ä¸€ä¸ªCommandæ¥å£ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªexecute()æ–¹æ³•ã€‚</p>

<p>ä¹‹åæˆ‘ä»¬ä¼šç”¨å®ƒçš„å®ç°ç±»æ¥æ“ä½œå„ç§ç”µå™¨ã€‚</p>

<p>```java
public class LightOnCommand implements Command {</p>

<pre><code>Light light;

public LightOnCommand(Light light) {
    this.light = light;
}

public void execute() {
    light.on();
}
</code></pre>

<p>}</p>

<p>public class LightOffCommand implements Command {</p>

<pre><code>Light light;

public LightOffCommand(Light light) {
    this.light = light;
}

public void execute() {
    light.off();
}
</code></pre>

<p>}</p>

<p>public class TVOnCommand implements Command {</p>

<pre><code>TV tv;

public TVOnCommand(TV tv) {
    this.tv = tv;
}

public void execute() {
    tv.on();
    tv.setInputChannel();
}
</code></pre>

<p>}</p>

<p>public class TVOffCommand implements Command {</p>

<pre><code>TV tv;

public TVOffCommand(TV tv) {
    this.tv = tv;
}

public void execute() {
    tv.off();
}
</code></pre>

<p>}</p>

<p>public class StereoOnCommand implements Command {</p>

<pre><code>Stereo stereo;

public StereoOnCommand(Stereo stereo) {
    this.stereo = stereo;
}

public void execute() {
    stereo.on();
}
</code></pre>

<p>}</p>

<p>public class StereoOffCommand implements Command {</p>

<pre><code>Stereo stereo;

public StereoOffCommand(Stereo stereo) {
    this.stereo = stereo;
}

public void execute() {
    stereo.off();
}
</code></pre>

<p>}</p>

<p>public class HottubOnCommand implements Command {</p>

<pre><code>Hottub hottub;

public HottubOnCommand(Hottub hottub) {
    this.hottub = hottub;
}

public void execute() {
    hottub.on();
    hottub.setTemperature(104);
    hottub.circulate();
}
</code></pre>

<p>}</p>

<p>public class HottubOffCommand implements Command {</p>

<pre><code>Hottub hottub;

public HottubOffCommand(Hottub hottub) {
    this.hottub = hottub;
}

public void execute() {
    hottub.setTemperature(98);
    hottub.off();
}
</code></pre>

<p>}
```</p>

<p>è¿™ä¸€å¤§å¨ï¼Œå°±æ˜¯Commandçš„å®ç°äº†ã€‚</p>

<p>å››å¤§ä»¶ç”µå™¨ï¼Œäºæ˜¯ä¾¿æœ‰å…«ä¸ªCommandï¼Œåˆ†åˆ«è´Ÿè´£æ¯ä¸ªç”µå™¨çš„å¼€å¯å’Œå…³é—­ã€‚</p>

<p>æœ‰äº›ç”µå™¨çš„å¼€å¯å’Œå…³é—­æ¯”åˆ«çš„è¦å¤æ‚ä¸€äº›ï¼Œä¸è¿‡è¿™æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºå®ƒä»¬çš„ç»†èŠ‚éƒ½è¢«å°è£…åœ¨Commandçš„å®ç°ç±»é‡Œé¢äº†ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»£ç åªè¦å’ŒCommandè¿™ä¸ªæ¥å£æ‰“äº¤é“å°±å¥½äº†ã€‚</p>

<p>```java
public class MacroCommand implements Command {</p>

<pre><code>Command[] commands;

public MacroCommand(Command[] commands) {
    this.commands = commands;
}

public void execute() {
    for (int i = 0; i &lt; commands.length; i++) {
        commands[i].execute();
    }
}
</code></pre>

<p>}
```</p>

<p>è¿˜æœ‰ä¸€ä¸ªå®å‘½ä»¤ï¼Œç”¨æ¥ç»„åˆå…¶ä»–å‘½ä»¤ã€‚</p>

<p>```java
public class RemoteControl {</p>

<pre><code>Command[] onCommands;
Command[] offCommands;

public RemoteControl() {
    onCommands = new Command[7];
    offCommands = new Command[7];
}

public void setCommand(int slot, Command onCommand, Command offCommand) {
    onCommands[slot] = onCommand;
    offCommands[slot] = offCommand;
}

public void onButtonWasPushed(int slot) {
    onCommands[slot].execute();
}

public void offButtonWasPushed(int slot) {
    offCommands[slot].execute();
}
</code></pre>

<p>}
```</p>

<p>å¯ä»¥å®ç°é¥æ§å™¨äº†ã€‚</p>

<p><img src="http://elisabethrobson.com/wp-content/uploads/2014/07/Command.jpg" alt="http://elisabethrobson.com/wp-content/uploads/2014/07/Command.jpg" /></p>

<p>è¿™ä¸ªé¥æ§å™¨ä¸Šçš„æŒ‰é’®éƒ½æ˜¯ç©ºç™½çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®ƒç½®å…¥ä»»æ„æˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ã€‚</p>

<p>```java
public class RemoteLoader {</p>

<pre><code>public static void main(String[] args) {
    RemoteControl remoteControl = new RemoteControl();

    Light light = new Light("Living Room");
    TV tv = new TV("Living Room");
    Stereo stereo = new Stereo("Living Room");
    Hottub hottub = new Hottub();

    Command[] partyOn = {
            new LightOnCommand(light), new StereoOnCommand(stereo),
            new TVOnCommand(tv), new HottubOnCommand(hottub)};

    Command[] partyOff = {new LightOffCommand(light), new StereoOffCommand(stereo),
            new TVOffCommand(tv), new HottubOffCommand(hottub)};

    remoteControl.setCommand(0, new MacroCommand(partyOn), new MacroCommand(partyOff));

    System.out.println("--- Pushing Macro On---");
    remoteControl.onButtonWasPushed(0);
    System.out.println("--- Pushing Macro Off---");
    remoteControl.offButtonWasPushed(0);
}
</code></pre>

<p>}
```</p>

<p>ç»ˆäºå¯ä»¥å†™ä¸€ä¸ªmainå‡½æ•°äº†ï¼š</p>

<ul>
<li>æŠŠå®¶ç”¨ç”µå™¨å’Œå…¶å¯¹åº”çš„Commandè”ç³»èµ·æ¥</li>
<li>æŠŠå„ç§Commandç»„åˆæˆå¼€å¯å’Œå…³é—­ä¸¤ä¸ªå®å‘½ä»¤</li>
<li>æŠŠå®å‘½ä»¤ç½®å…¥é¥æ§å™¨</li>
</ul>


<p>ç„¶åï¼Œåªè¦æŒ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå°±å¯ä»¥å¼€å¯æ‰€æœ‰ç”µå™¨ï¼Œäº«å—èµ„äº§é˜¶çº§å¥¢é¡çš„ç”Ÿæ´»äº†ã€‚</p>

<p>äº«å—å¤Ÿäº†ä¹‹ååªè¦å†æŒ‰ä¸€ä¸ªæŒ‰é’®å°±å¯ä»¥æŠŠæ‰€æœ‰ç”µå™¨å…³é—­æ‰ã€‚</p>

<p>å¦‚æœå†æœ‰åˆ«çš„ç”µå™¨ï¼Œåªéœ€è¦å®ç°å‡ ä¸ªæ–°çš„Commandï¼ŒæŠŠæ–°çš„Commandç»„åˆå…¥å®å‘½ä»¤ï¼Œç»§ç»­ä½¿ç”¨é¥æ§å™¨å°±å¥½äº†ã€‚</p>

<p>æ¢å¥è¯è¯´ï¼Œå› ä¸ºé¥æ§å™¨å’Œç”µå™¨ä¹‹é—´é€šè¿‡Commandè§£è€¦äº†ï¼Œå¢åŠ æ–°çš„ç”µå™¨å’Œæ–°çš„Commandå¯¹äºé¥æ§å™¨æ²¡æœ‰å½±å“ï¼Œé¥æ§å™¨çš„ä»£ç æ˜¯ç¨³å®šçš„ã€‚è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>

<p>å¾ˆå¥½ï¼Œå¾ˆç¬¦åˆè‰¯å¥½çš„è®¾è®¡åŸåˆ™ï¼Œçœ‹ç€å°±èˆ’æœå¯¹å§ï¼Ÿ</p>

<h2>ä¸è¿‡å†æƒ³ä¸€ä¸‹</h2>

<p>ç”µç¯çš„å¼€å¯å’Œå…³é—­è¿™ä¸¤ä¸ªå‘½ä»¤ä»…ä»…æ˜¯å¯¹ç”µç¯çš„ä¸¤ä¸ªæ–¹æ³•çš„ç®€å•ä»£ç†ã€‚</p>

<p>éŸ³å“çš„å¼€å¯å’Œå…³é—­è¿™ä¸¤ä¸ªå‘½ä»¤ä»…ä»…æ˜¯å¯¹éŸ³å“çš„ä¸¤ä¸ªæ–¹æ³•çš„ç®€å•ä»£ç†ã€‚</p>

<p>ç”µè§†æœºçš„å…³é—­ä¹Ÿæ˜¯ç®€å•çš„ä»£ç†ã€‚</p>

<p>è¿™äº›å‘½ä»¤ç±»æ˜¯å¦çœ‹èµ·æ¥å¤ªå•è–„äº†å‘¢ï¼Ÿå®ƒä»¬çš„æ–¹æ³•å¼‚å¸¸ç˜¦å¼±ï¼Œè¥å…»ä¸è‰¯ã€‚</p>

<p>å®ƒä»¬é™¤äº†æŒæœ‰ä¸€ä¸ªéœ€è¦æ“ä½œçš„ç”µå™¨çš„å®ä¾‹ä¹‹å¤–ï¼ŒåŸºæœ¬æ²¡æœ‰ä»€ä¹ˆå®ä¾‹çº§çŠ¶æ€ã€‚</p>

<p>ï¼ˆç”µè§†å¼€æœºè¿˜å¥½ï¼Œç”±äºéœ€è¦é€‰æ‹©é¢‘é“ï¼Œå¥½æ­¹è°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³•ã€‚
æ°´ç–—æµ´ç¼¸æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è°ƒèŠ‚æ¸©åº¦ï¼Œæ‰€ä»¥ä¹Ÿè¿˜ç¨å¾®å¥½ä¸€äº›ã€‚ï¼‰</p>

<p>æ¯æ¬¡çœ‹åˆ°è¿™ç§è´«è¡€çš„ç±»ï¼Œæˆ‘å°±æ€€ç–‘å®ƒä»¬å­˜åœ¨çš„å¿…è¦æ€§ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³è¦ç»™å®¶ç”¨ç”µå™¨å†…çš„æ–¹æ³•æ„é€ ä¸€ä¸ªç»Ÿä¸€ä¸ªçš„å¯¹å¤–æ¥å£ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨å‡½æ•°å¼æ¥å®ç°å‘¢ï¼Ÿ</p>

<h1>functions</h1>

<p>æ¥è¯•è¯•ç”¨Scalaå®ç°ï¼š</p>

<p>```scala
case class Light(location: String) {
  def on() = println(s"$location light is on")</p>

<p>  def off() = println(s"$location light is off")
}</p>

<p>case class TV(location: String) {
  private var channel: Int = 0</p>

<p>  def on() = println(location + " TV is on")</p>

<p>  def off() = println(location + " TV is off")</p>

<p>  def setInputChannel() = {</p>

<pre><code>this.channel = 3
println(location + " TV channel is set for DVD")
</code></pre>

<p>  }
}</p>

<p>case class Stereo(location: String) {
  def on() = println(s"$location stereo is on")</p>

<p>  def off() = println(s"$location stereo is off")
}</p>

<p>case class Hottub(var isOn: Boolean = false) {
  private var temperature: Int = 0</p>

<p>  def on() = isOn = true</p>

<p>  def off() = isOn = false</p>

<p>  def circulate() = if (isOn) println("Hottub is bubbling!")</p>

<p>  def setTemperature(temperature: Int) = {</p>

<pre><code>if (temperature &gt; this.temperature) {
  println("Hottub is heating to a steaming " + temperature + " degrees")
}
else {
  println("Hottub is cooling to " + temperature + " degrees")
}
this.temperature = temperature
</code></pre>

<p>  }
}
```</p>

<p>é¦–å…ˆæ˜¯æœ‰å››å¤§ä»¶å®¶ç”¨ç”µå™¨ï¼Œè¿™éƒ¨åˆ†å’ŒJavaçš„ä»£ç ç­‰ä»·ã€‚</p>

<p>```scala
object Commands {
  type Command = () => Unit</p>

<p>  def tvOn(tv: TV): Command = () => {</p>

<pre><code>tv.on()
tv.setInputChannel()
</code></pre>

<p>  }</p>

<p>  def hottubOn(hottub: Hottub): Command = () => {</p>

<pre><code>hottub.on()
hottub.setTemperature(104)
hottub.circulate()
</code></pre>

<p>  }</p>

<p>  def hottubOff(hottub: Hottub): Command = () => {</p>

<pre><code>hottub.setTemperature(98)
hottub.off()
</code></pre>

<p>  }</p>

<p>  def macroCommand(commands: Command*): Command = () =></p>

<pre><code>commands.foreach(command =&gt; command())
</code></pre>

<p>}
```</p>

<p>è¿™ä¸€æ®µç”¨æ¥å®šä¹‰å„ç§å‘½ä»¤çš„ä»£ç å°±ä¸åŒäº†ã€‚</p>

<p>æˆ‘ä»¬å¯¹å®¶ç”¨ç”µå™¨çš„å„ç§æ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯åªæœŸå¾…å…¶å‰¯ä½œç”¨ï¼Œä¸æœŸå¾…ä»»ä½•è¿”å›å€¼çš„ã€‚æ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ç­¾åCommandæ¥æ¶µç›–æ‰€æœ‰è¿™ç±»æ“ä½œã€‚</p>

<p>å’Œä¸Šé¢çš„Javaä»£ç ç±»ä¼¼ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå®å‘½ä»¤ï¼Œåªä¸è¿‡å®ç°ç®€å•ä¸€äº›ã€‚</p>

<p>ç”µè§†çš„å¼€å¯ï¼Œæ°´ç–—æµ´ç¼¸çš„å¼€å’Œå…³éƒ½æœ‰å¯¹åº”çš„æ–¹æ³•æ¥æŠŠå®¶ç”¨ç”µå™¨çš„å®ä¾‹å°å…¥é—­åŒ…ä¸­ã€‚</p>

<p>å’¦ï¼Ÿç”µç¯çš„å¼€å…³ï¼ŒéŸ³å“çš„å¼€å…³ï¼Œä»¥åŠç”µè§†çš„å…³é—­éƒ½è·‘å“ªå„¿å»äº†å‘¢ï¼Ÿ</p>

<p>ç”±äºè¿™å‡ ä¸ªæ“ä½œéƒ½åªæ¶‰åŠåˆ°ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼Œå®ƒä»¬ç›´æ¥å°±ç¬¦åˆCommandçš„å‡½æ•°ç­¾åï¼Œæ‰€ä»¥ä¸ç”¨å†å°å…¥ä»»ä½•é—­åŒ…äº†ã€‚è¿™ä¸€ç‚¹çœ‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†ã€‚</p>

<p>```scala
case class RemoteControl(onCommands: Seq[Command], offCommands: Seq[Command]) {
  def pushOnButton(slot: Int) = onCommands(slot)()</p>

<p>  def pushOffButton(slot: Int) = offCommands(slot)()
}</p>

<p>object RemoteLoader {
  def main(args: Array[String]) {</p>

<pre><code>val light = Light("living room")
val tv = TV("living room")
val stereo = Stereo("living room")
val hottub = Hottub()

val on = macroCommand(light.on,
  stereo.on, tvOn(tv), hottubOn(hottub))

val off = macroCommand(light.off,
  stereo.off, tv.off, hottubOff(hottub))

val remoteControl = RemoteControl(Seq(on), Seq(off))

println("--- Pushing Macro On---")
remoteControl.pushOnButton(0)
println("--- Pushing Macro Off---")
remoteControl.pushOffButton(0)
</code></pre>

<p>  }
}
```</p>

<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé¥æ§å™¨ã€‚å…¶ä¸­æœ‰å¼€å¯ï¼Œå’Œå…³é—­ä¸¤æ’æŒ‰é’®ã€‚</p>

<p>æœ€åï¼Œå¯ä»¥å†™ä¸€ä¸ªmainå‡½æ•°ï¼Œå…¶ä¸­æ‰€åšçš„äº‹æƒ…å’Œä¹‹å‰Javaä»£ç mainå‡½æ•°æ‰€åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>åªä¸è¿‡ï¼Œä¸éœ€è¦åˆ›å»ºå„ç§Commandçš„å®ä¾‹ã€‚</p>

<p>è€Œä¸”light.onï¼Œstereo.onï¼Œlight.offï¼Œstereo.offï¼Œtv.offè¿™å‡ ä¸ªæ–¹æ³•ç”±äºç¬¦åˆCommandçš„ç­¾åï¼Œæ˜¯å¯ä»¥ç›´æ¥æ‹¿æ¥å½“Commandç”¨çš„ã€‚ï¼ˆæ³¨æ„æ–¹æ³•ååé¢æ²¡æœ‰()ï¼Œä¸æ˜¯è°ƒç”¨ï¼Œè€Œæ˜¯å‡½æ•°ä¼ é€’ï¼‰</p>

<p>å‰åä¸¤ç‰ˆä»£ç æ˜¯ç­‰ä»·çš„ã€‚åªä¸è¿‡ï¼š</p>

<ul>
<li>247è¡Œä»£ç å˜æˆäº†93è¡Œä»£ç </li>
<li>16ä¸ªå®ä½“å˜æˆäº†7ä¸ª</li>
</ul>


<p>ä½œä¸ºä¸€ä¸ªå¤šæŒ‰å‡ ä¸ªæŒ‰é’®éƒ½å«Œéº»çƒ¦çš„å¥½é€¸æ¶åŠ³çš„èµ„äº§é˜¶çº§ï¼Œè¿™ä¸ªç»“æœæ˜¯æˆ‘æ‰€ä¹äºè§åˆ°çš„ã€‚</p>

<p>æ›´å°‘ï¼Œæ›´ç´§å‡‘çš„ä»£ç ã€‚æ›´å°‘çš„å®ä½“ã€‚æˆ‘ç»ˆäºå¯ä»¥ç”¨æ›´å°çš„æˆæœ¬æ¥äº«å—æˆ‘æ˜‚è´µçš„å®¶ç”¨ç”µå™¨äº†ã€‚</p>

<h1>æŒ‡ç”²åˆ€åˆ®èƒ¡å­</h1>

<p>æœ€åå›åˆ°æ ‡é¢˜ä¸Šå»ï¼šæŒ‡ç”²åˆ€åˆ®èƒ¡å­ï¼Œæ„å³ç”¨ä¸åˆé€‚çš„å·¥å…·è§£å†³é—®é¢˜ã€‚</p>

<p>å‘½ä»¤æ¨¡å¼æƒ³è¦åšåˆ°çš„äº‹æƒ…å…¶å®å°±æ˜¯ç»™å„ç§ä¸åŒçš„æ“ä½œå¯»æ‰¾ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä»è€Œå®ç°è°ƒç”¨è€…ï¼ˆé¥æ§å™¨ï¼‰å’Œè¢«è°ƒç”¨è€…ï¼ˆå®¶ç”¨ç”µå™¨ï¼‰ä¹‹é—´çš„è§£è€¦ã€‚</p>

<p>ç»™ä¸åŒçš„æ“ä½œå¯»æ‰¾ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£è¿™ä»¶äº‹å¯ä»¥é€šè¿‡æ¥å£æ¥åšï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ—¶è¦æ‰¿æ‹…å†™ä¸€å †è´«è¡€ç±»çš„ä»£ä»·ã€‚</p>

<p>è€Œå¦‚æœç›´æ¥ç”¨å‡½æ•°æ¥åšçš„è¯ï¼Œåˆ™å¯ä»¥å¾—åˆ°æ›´ç´§å‡‘ç®€æ´çš„ä»£ç ï¼ˆå°±åƒobject Commandsè¿™ä¸ªå®ä½“å†…çš„ä»£ç ä¸€æ ·ï¼‰ã€‚</p>

<p>è¯¥æ¨¡å¼æå‡ºçš„æ—¶å€™FPå¹¶ä¸å¦‚ä»Šæ—¥ç››è¡Œï¼Œå…¶ä½œè€…é€‰ç”¨äº†å¯èƒ½ä¼šå¯¼è‡´è´«è¡€ç±»æ³›æ»¥çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™æ— å¯åšéã€‚ä¼ æ’­äº†è§£è€¦å’Œå¼€é—­ç­‰è‰¯å¥½è®¾è®¡çš„åŸåˆ™ä¹Ÿå®ä¸ºåŠŸå¾·ã€‚</p>

<p>ä¸è¿‡ä»Šå¤©æˆ‘ä»¬æœ‰äº†å‰ƒé¡»åˆ€ï¼Œå°±æ— éœ€ä¸€å®šè¦ç”¨æŒ‡ç”²åˆ€æ¥åˆ®èƒ¡å­äº†ã€‚</p>
]]></content>
  </entry>
  
</feed>
